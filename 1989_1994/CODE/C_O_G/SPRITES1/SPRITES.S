;X	EQU	6	;(COLONNES DE 16 PIXELS)+1
;Y	EQU	81	;HAUTEUR
NB_DECAL	EQU	8	;8 OU 16
NB_DEC	EQU	1	;1 POUR 8 ET 0 POUR 16
PAS	EQU	15*6	;PRISE DE POS DANS LA COURBE
NB_POINTS	EQU	960

NB_PTS=104
PAS_C=3
NB_POS=360/PAS_C

;	clr	x_angle
;	clr	y_angle
;	clr	z_angle

;	CLR.L	POINTEUR
	
;	LEA	DATA_Y,A2
;	LEA	DATA_X,A1
	
;	move	#256,z_pt_fuite

;	move.l	#NB_POS-1,d7
;ici	CLR.L	POINTEUR
;	jsr	trigo
;	rept	NB_PTS
;	jsr	sp_to_pl
;	jsr	ROUTINE
;	endr
;	ADD	#2*PAS_C,x_angle
;	ADD	#2*PAS_C,y_angle
;	ADD	#2*PAS_C,z_angle
;	dbf	d7,ici



	CLR.L	-(SP)
	MOVE.W	#$20,-(SP)
	TRAP	#1
	ADDQ.L	#6,SP
	MOVE.L	D0,SAUV_SP

	LEA	PIC,A0
	LEA	DECRUNCHED,A1
	JSR	decrunch

	CLR.W	-(SP)
	MOVE.L	#-1,-(SP)
	MOVE.L	#-1,-(SP)
	MOVE.W	#5,-(SP)
	TRAP	#14
	LEA	12(SP),SP

	MOVEQ	#1,D0
	JSR	ZIK
	
	MOVEM.L	$FFFF8240.W,D0-D7
	MOVEM.L	D0-D7,ANC_PAL

	MOVE.B	$FFFF8201.W,SAUVEC
	MOVE.B	$FFFF8203.W,SAUVEC+1
	BSR	PREP_ECR
	BSR	MAK_COD
	LEA	DECRUNCHED+34+120,A0
	BSR	PREDECALET
	MOVE.L	SCREEN1,A0
	MOVE.L	SCREEN2,A1
	MOVE.W	#7999,D7
RECOMEFF	CLR.L	(A0)+
	CLR.L	(A1)+
	DBRA	D7,RECOMEFF
	LEA	COURB,A0
	LEA	FIN_CRB,A1
	MOVE.L	-12(A1),-12(A0)
	MOVE.L	-8(A1),-8(A0)
	MOVE.L	-4(A1),-4(A0)	
	MOVE.W	#((PAS/6)*8)-2,D7
RECOP1	MOVE.L	(A0)+,(A1)+
	MOVE.W	(A0)+,(A1)+
	DBRA	D7,RECOP1
	MOVE.L	#-1,(A1)

	MOVE.L	#COURB,PNT_CRB

	MOVE.L	#FIN,$008
	MOVE.L	#FIN,$00C
	MOVE.L	#FIN,$010
	MOVE.L	#FIN,$014
	MOVE.L	#FIN,$018
	MOVE.L	#FIN,$01C
	MOVE.L	#FIN,$020

	ANDI.B	#%11111000,$484.W

	MOVEM.L	DECRUNCHED+2,D0-D7
	MOVEM.L	D0-D7,$FFFF8240.W

	MOVE.B	$FFFFFA07.W,MFP
	MOVE.B	$FFFFFA09.W,MFP+1
	MOVE.B	$FFFFFA0F.W,MFP+2
	MOVE.B	$FFFFFA13.W,MFP+3
	MOVE.B	$FFFFFA1B.W,MFP+4
	MOVE.B	$FFFFFA21.W,MFP+5

	CLR.B	$FFFFFA07.W
	CLR.B	$FFFFFA09.W

	CLR.L	CNT
	MOVE.L	#NB_POS-2,CNT2
		
	LEA	DATA_X,A0
	LEA	DATA_Y,A1
	LEA	DATA_Y+(NB_PTS*(NB_POS-2)*2),A3
	move.l	SCREEN1,A2
	MOVEM.L	D0-A6,REG_3D
	
	MOVE.L	$70.W,ANC_VBL
	MOVE.L	$120.W,ANC_TIM
	MOVE.L	#VBLR,$70.W
	MOVE.L	#TB0,$120.W
	BSET	#0,$FFFFFA07.W
	BSET	#0,$FFFFFA13.W
	
LOOP	
	LEA	FAD_ZAP,A0
	ADDA.L	PNT_FAD,A0
	CMPI.L	#-1,(A0)
	BNE.S	CA_TOURNE
	JMP	NEXT_ONE
CA_TOURNE	MOVEM.L	(A0),D0-D6
	MOVEM.L	D0-D6,$FFFF8242.W
	ADDQ.L	#1,PNT_FAD2
	CMPI.L	#60,PNT_FAD2
	BNE.S	LOOP
	CLR.L	PNT_FAD2
	ADD.L	#7*2,PNT_FAD
	JMP	LOOP
NEXT_ONE	CMPI.B	#$3B,$FFFFFC02.W
	BNE.S	NEXT_ONE
	ADDQ.L	#1,NUMERO
BLOCKED	JMP	BLOCKED

FAD_ZAP	DCB	7*2,$0

	DC	$0,$100,$100,$100,$100,$100,$000
	DC	$0,$200,$100,$100,$100,$100,$000
	DC	$0,$300,$200,$100,$100,$100,$000
	DC	$0,$400,$300,$200,$100,$100,$000
	DC	$0,$500,$400,$300,$200,$100,$000
	DC	$0,$600,$500,$400,$300,$200,$100

	DC	$0,$610,$510,$410,$310,$210,$100
	DC	$0,$620,$510,$410,$310,$210,$100
	DC	$0,$630,$520,$410,$310,$210,$100
	DC	$0,$640,$530,$420,$310,$210,$100
	DC	$0,$650,$540,$430,$320,$210,$100
	DC	$0,$660,$550,$440,$330,$220,$110

	DC	$0,$661,$550,$440,$330,$220,$110
	DC	$0,$662,$551,$440,$330,$220,$110
	DC	$0,$663,$552,$441,$330,$220,$110
	DC	$0,$664,$553,$442,$331,$220,$110
	DC	$0,$665,$554,$443,$332,$221,$110
	DC	$0,$666,$555,$444,$333,$222,$111
	DC.L	-1
	
FIN	MOVE.W	#$2700,SR
	MOVE.L	ANC_VBL,$70.W
	MOVE.L	ANC_TIM,$120.W
	
	MOVE.B	MFP,$FFFFFA07.W
	MOVE.B	MFP+1,$FFFFFA09.W
	MOVE.B	MFP+2,$FFFFFA0F.W
	MOVE.B	MFP+3,$FFFFFA13.W
	MOVE.B	MFP+4,$FFFFFA1B.W
	MOVE.B	MFP+5,$FFFFFA21.W

	MOVE.W	#$2300,SR
	MOVE.B	SAUVEC,$FFFF8201.W
	MOVE.B	SAUVEC+1,$FFFF8203.W

	MOVEM.L	ANC_PAL,D0-D7
	MOVEM.L	D0-D7,$FFFF8240.W
	
	ORI.B	#%00000111,$484.W
	
	MOVE.L	#$8080000,$FFFF8800.W
	MOVE.L	#$9090000,$FFFF8800.W
	MOVE.L	#$A0A0000,$FFFF8800.W
	
	MOVE.L	SAUV_SP,-(SP)
	MOVE.W	#$20,-(SP)
	TRAP	#1
	ADDQ.L	#6,SP
	
	CLR.W	-(SP)
	TRAP	#1
	ADDQ.L	#2,SP

CHANGE_DATAS_ZERIOUL
	LEA	CHANGEY1,A0
	MOVE.L	#$3C3C003C,(A0)
	LEA	CHANGEY2,A0
	MOVE.L	#$3A3C003C,(A0)
	LEA	CHANGEY3,A0
	MOVE.L	#$3C3C003C,(A0)
	LEA	CHANGEY4,A0
	MOVE.L	#$3C3C003C,(A0)
	LEA	CHANGEY5,A0
	MOVE.L	#$3C3C003C,(A0)
	LEA	CHANGEY6,A0
	MOVE.L	#$3C3C003C,(A0)
	LEA	CHANGEY8,A0
	MOVE.L	#$3E3C0130,(A0)
	LEA	CHANGEY9,A0
	MOVE.L	#$3A3C003C,(A0)
	LEA	CHANGEY10,A0
	MOVE.L	#$41E8F678,(A0)
	LEA	CHANGEY11,A0
	MOVE.L	#$3C3C003C,(A0)

	MOVE.L	#$3E3C0004,D0
	LEA	CHANGE1,A0
	MOVE.L	D0,(A0)
	SUB.L	#1,(A0)
	LEA	CHANGE3,A0
	MOVE.L	D0,(A0)
	LEA	CHANGE6,A0
	MOVE.L	D0,(A0)
	LEA	CHANGE7,A0
	MOVE.L	D0,(A0)
	LEA	CHANGE9,A0
	MOVE.L	D0,(A0)
	LEA	CHANGE15,A0
	MOVE.L	D0,(A0)
	LEA	CHANGE19,A0
	MOVE.L	D0,(A0)
	LEA	CHANGE2,A0
	MOVE.L	#$41E80080,(A0)
	LEA	CHANGE4,A0
	MOVE.L	#$41E8FFDA,(A0)
	LEA	CHANGE5,A0
	MOVE.L	#$41E80020,(A0)
	LEA	CHANGE8,A0
	MOVE.L	#$34FC0078,(A0)
	LEA	CHANGE10,A0
	MOVE.L	#$34FC0078,(A0)
	LEA	CHANGE11,A0
	MOVE.L	#$3E3C0003,(A0)
	LEA	CHANGE20,A0
	MOVE.L	#$34FC0078,(A0)
	LEA	CHANGE12,A0
	MOVE.L	#$41E80080,(A0)
	LEA	CHANGE18,A0
	MOVE.L	#$41E8F678,(A0)
	LEA	CHANGE17,A0
	MOVE.L	#$41E80020,(A0)
	LEA	CHANGE16,A0
	MOVE.L	#$41E8FFDA,(A0)
	LEA	CHANGE13,A0
	MOVE.L	#$43E80988,(A0)
	LEA	CHANGE14,A0
	MOVE.L	#$3E3C0130,(A0)

	RTS

CHANGE_DATAS_DANATO
	LEA	CHANGEY1,A0
	MOVE.L	#$3C3C003E,(A0)
	LEA	CHANGEY2,A0
	MOVE.L	#$3A3C003E,(A0)
	LEA	CHANGEY3,A0
	MOVE.L	#$3C3C003E,(A0)
	LEA	CHANGEY4,A0
	MOVE.L	#$3C3C003E,(A0)
	LEA	CHANGEY5,A0
	MOVE.L	#$3C3C003E,(A0)
	LEA	CHANGEY6,A0
	MOVE.L	#$3C3C003E,(A0)
	LEA	CHANGEY7,A0
	MOVE.L	#$43E809D8,(A0)
	LEA	CHANGEY8,A0
	MOVE.L	#$3E3C013A,(A0)
	LEA	CHANGEY9,A0
	MOVE.L	#$3A3C003E,(A0)
	LEA	CHANGEY10,A0
	MOVE.L	#$41E8F628,(A0)
	LEA	CHANGEY11,A0
	MOVE.L	#$3C3C003E,(A0)

	RTS
CHANGE_DATAS_BLYZ
	LEA	CHANGEY1,A0
	MOVE.L	#$3C3C0039,(A0)
	LEA	CHANGEY2,A0
	MOVE.L	#$3A3C0039,(A0)
	LEA	CHANGEY3,A0
	MOVE.L	#$3C3C0039,(A0)
	LEA	CHANGEY4,A0
	MOVE.L	#$3C3C0039,(A0)
	LEA	CHANGEY5,A0
	MOVE.L	#$3C3C0039,(A0)
	LEA	CHANGEY6,A0
	MOVE.L	#$3C3C0039,(A0)
	LEA	CHANGEY9,A0
	MOVE.L	#$3A3C0039,(A0)
	LEA	CHANGEY11,A0
	MOVE.L	#$3C3C0039,(A0)
	LEA	CHANGEY8,A0
	MOVE.L	#$3E3C00E7,(A0)
	LEA	CHANGEY10,A0
	MOVE.L	#$41E8F8C0,(A0)

	MOVE.L	#$3E3C0003,D0
	LEA	CHANGE1,A0
	MOVE.L	D0,(A0)
	SUB.L	#1,(A0)
	LEA	CHANGE3,A0
	MOVE.L	D0,(A0)
	LEA	CHANGE6,A0
	MOVE.L	D0,(A0)
	LEA	CHANGE7,A0
	MOVE.L	D0,(A0)
	LEA	CHANGE9,A0
	MOVE.L	D0,(A0)
	LEA	CHANGE15,A0
	MOVE.L	D0,(A0)
	LEA	CHANGE19,A0
	MOVE.L	D0,(A0)
	LEA	CHANGE2,A0
	MOVE.L	#$41E80088,(A0)
	LEA	CHANGE4,A0
	MOVE.L	#$41E8FFE2,(A0)
	LEA	CHANGE12,A0
	MOVE.L	#$41E80088,(A0)
	LEA	CHANGE5,A0
	MOVE.L	#$41E80018,(A0)
	LEA	CHANGE8,A0
	MOVE.L	#$34FC0080,(A0)
	LEA	CHANGE10,A0
	MOVE.L	#$34FC0080,(A0)
	LEA	CHANGE20,A0
	MOVE.L	#$34FC0080,(A0)
	LEA	CHANGE11,A0
	MOVE.L	#$3E3C0002,(A0)
	LEA	CHANGE17,A0
	MOVE.L	#$41E80018,(A0)
	LEA	CHANGE14,A0
	MOVE.L	#$3E3C00E7,(A0)
	LEA	CHANGE18,A0
	MOVE.L	#$41E8F8C0,(A0)
	LEA	CHANGE16,A0
	MOVE.L	#$41E8FFE2,(A0)
	LEA	CHANGE13,A0
	MOVE.L	#$43E80740,(A0)
	RTS

VBLR	MOVEM.L	D0-A6,-(SP)
	CMPI.B	#$F,$FFFFFC02.W
	BNE.S	SUITV0
	ST	$FFFF8240.W
SUITV0	
	MOVE.L	PNT_CRB,A5
	SUBA.L	#12,A5
	MOVEQ	#0,D0
	MOVEQ	#0,D1
	MOVEQ	#0,D2
	MOVEQ	#0,D3
	MOVEQ	#0,D4
	MOVEQ	#0,D5
	MOVEQ	#0,D6
	MOVEQ	#0,D7
	MOVE.L	#0,A0
	MOVE.L	#0,A1
	MOVE.L	#0,A2
	MOVE.L	#0,A3

	MOVE.L	SCREEN2,A4
	ADDA.W	4(A5),A4
N	SET	0
	REPT	81
	MOVEM.L	D0-D7/A0-A3,N(A4)
N	SET	N+160
	ENDR
	LEA	PAS(A5),A5

	MOVE.L	SCREEN2,A4
	ADDA.W	4(A5),A4
N	SET	0
	REPT	81
	MOVEM.L	D0-D7/A0-A3,N(A4)
N	SET	N+160
	ENDR
	LEA	PAS(A5),A5

	MOVE.L	SCREEN2,A4
	ADDA.W	4(A5),A4
N	SET	0
	REPT	81
	MOVEM.L	D0-D7/A0-A3,N(A4)
N	SET	N+160
	ENDR
	LEA	PAS(A5),A5

	MOVE.L	SCREEN2,A4
	ADDA.W	4(A5),A4
N	SET	0
	REPT	81
	MOVEM.L	D0-D7/A0-A3,N(A4)
N	SET	N+160
	ENDR
	LEA	PAS(A5),A5

	MOVE.L	SCREEN2,A4
	ADDA.W	4(A5),A4
N	SET	0
	REPT	81
	MOVEM.L	D0-D7/A0-A3,N(A4)
N	SET	N+160
	ENDR

	MOVE.L	PNT_CRB,A5

	LEA	PREDEC_TAB,A4
	MOVE.W	(A5),D0
	LSR	#1,D0
	MOVE.L	(A4,D0.W),A0
	MOVE.L	SCREEN2,A1
	ADDA.W	4(A5),A1
N	SET	0
	REPT	81
	MOVEM.L	(A0)+,D0-D7/A2-A5
	MOVEM.L	D0-D7/A2-A5,N(A1)
N	SET	N+160
	ENDR

	MOVE.L	PNT_CRB,A5
	LEA	PAS(A5),A5
	MOVE.L	#0,A4

	MOVE.L	SCREEN2,A3

	LEA	TABLE_GEN,A6
	LEA	24*8(A6),A6
	ADDA.W	2(A5),A6
	MOVE.L	A3,A0
	ADDA.W	4(A5),A0
	MOVE.L	A3,A1
	ADDA.W	4(A5),A1
	MOVE.L	(A6)+,A2	;MSK
	MOVE.L	(A6),A6
	JSR	(A6)

	LEA	PAS(A5),A5

	LEA	TABLE_GEN,A6
	LEA	24*8(A6),A6
	ADDA.W	2(A5),A6
	MOVE.L	A3,A0
	ADDA.W	4(A5),A0
	MOVE.L	A3,A1
	ADDA.W	4(A5),A1
	MOVE.L	(A6)+,A2	;MSK
	MOVE.L	(A6),A6
	JSR	(A6)

	LEA	PAS(A5),A5

	LEA	TABLE_GEN,A6
	LEA	12*8(A6),A6
	ADDA.W	2(A5),A6
	MOVE.L	A3,A0
	ADDA.W	4(A5),A0
	MOVE.L	A3,A1
	ADDA.W	4(A5),A1
	MOVE.L	(A6)+,A2	;MSK
	MOVE.L	(A6),A6
	JSR	(A6)

	LEA	PAS(A5),A5

	LEA	TABLE_GEN,A6
	ADDA.W	2(A5),A6
	MOVE.L	A3,A0
	ADDA.W	4(A5),A0
	MOVE.L	A3,A1
	ADDA.W	4(A5),A1
	MOVE.L	(A6)+,A2	;MSK
	MOVE.L	(A6),A6
	JSR	(A6)

	SF	$FFFF8240.W
	BSR	SWAPEC

	ADDQ.L	#6,PNT_CRB

	MOVE.L	PNT_CRB,A0
	CMPI.W	#-1,(PAS*8)-6(A0)
	BNE.S	FINF
	MOVE.L	#COURB,PNT_CRB
FINF	JSR	ZIK+8
	MOVEM.L	(SP)+,D0-A6
	CMPI.B	#$1,$FFFFFC02.W
	BEQ	FIN
	CMPI.L	#$1,NUMERO
	BEQ.S	SUITE_DEMO
	RTE
SUITE_DEMO
	MOVE	#$2300,SR
	MOVE.L	#VBL_ZIK,$70.W
	JSR	PREP_ECR
	LEA	PIC2,A0
	LEA	DECRUNCHED2,A1
	JSR	decrunch
	JSR	CHANGE_DATAS_ZERIOUL
	JSR	MAK_COD_ZERIOUL
	MOVE.L	#COURB,PNT_CRB
	LEA	DECRUNCHED2+34,A0
	BSR	PREDECALET
	MOVEM.L	DECRUNCHED2+2,D0-D7
	MOVEM.L	D0-D7,$FFFF8240.W
	JSR	PREP_ECR
	MOVE.L	#VBLR_ZERIOUL,$70.W
LOOPA	JMP	LOOPA

VBLR_ZERIOUL	CMPI.B	#$F,$FFFFFC02.W
	BNE.S	SUITZER
	ST	$FFFF8240.W
SUITZER
	MOVE.L	PNT_CRB,A5
	SUBA.L	#12,A5
	MOVEQ	#0,D0
	MOVEQ	#0,D1
	MOVEQ	#0,D2
	MOVEQ	#0,D3
	MOVEQ	#0,D4
	MOVEQ	#0,D5
	MOVEQ	#0,D6
	MOVEQ	#0,D7
	MOVE.L	#0,A0
	MOVE.L	#0,A1
	MOVE.L	#0,A2
	MOVE.L	#0,A3

	MOVE.L	SCREEN2,A4	;Z
	ADDA.W	4(A5),A4
N	SET	0
	REPT	61
	MOVEM.L	D0-D7/A0-A1,N(A4)
N	SET	N+160
	ENDR
	LEA	PAS(A5),A5


	MOVE.L	SCREEN2,A4	;E
	ADDA.W	4(A5),A4
N	SET	0
	REPT	61
	MOVEM.L	D0-D7/A0-A1,N(A4)
N	SET	N+160
	ENDR
	LEA	PAS(A5),A5

	MOVE.L	SCREEN2,A4	;R
	ADDA.W	4(A5),A4
N	SET	0
	REPT	61
	MOVEM.L	D0-D7/A0-A1,N(A4)
N	SET	N+160
	ENDR
	LEA	PAS(A5),A5

	MOVE.L	SCREEN2,A0
	LEA	TABLE_GEN+(36*8),A2
	MOVE.W	2(A5),D1
	MOVE.L	8(A2,D1.W),A1
	ADDA.W	4(A5),A0
	JSR	(A1)
	LEA	PAS(A5),A5

	MOVE.L	#0,A0
	MOVE.L	#0,A1
	MOVEQ	#0,D1
	
	MOVE.L	SCREEN2,A4	;O
	ADDA.W	4(A5),A4
N	SET	0
	REPT	61
	MOVEM.L	D0-D7/A0-A1,N(A4)
N	SET	N+160
	ENDR
	LEA	PAS(A5),A5

	MOVE.L	SCREEN2,A4	;U
	ADDA.W	4(A5),A4
N	SET	0
	REPT	61
	MOVEM.L	D0-D7/A0-A1,N(A4)
N	SET	N+160
	ENDR
	LEA	PAS(A5),A5

	MOVE.L	SCREEN2,A4	;L
	ADDA.W	4(A5),A4
N	SET	0
	REPT	61
	MOVEM.L	D0-D7/A0-A1,N(A4)
N	SET	N+160
	ENDR
	LEA	PAS(A5),A5

	*AFFICHAGE EN MOVEM

	MOVE.L	PNT_CRB,A5

	LEA	PREDEC_TAB,A4
	MOVE.W	(A5),D0
	LSR	#1,D0
	MOVE.L	(A4,D0.W),A0
	MOVE.L	SCREEN2,A1
	ADDA.W	4(A5),A1
N	SET	0
	REPT	61
	MOVEM.L	(A0)+,D0-D7/A2-A3
	MOVEM.L	D0-D7/A2-A3,N(A1)
N	SET	N+160
	ENDR

	MOVE.L	PNT_CRB,A5
	LEA	PAS(A5),A5
	MOVE.L	#0,A4

	MOVE.L	SCREEN2,A3

	LEA	TABLE_GEN+(60*8),A6	;U
	ADDA.W	2(A5),A6
	MOVE.L	A3,A0
	ADDA.W	4(A5),A0
	MOVE.L	A3,A1
	ADDA.W	4(A5),A1
	MOVE.L	(A6)+,A2	;MSK
	MOVE.L	(A6),A6
	JSR	(A6)
	LEA	PAS(A5),A5

	LEA	TABLE_GEN+(48*8),A6	;O
	ADDA.W	2(A5),A6
	MOVE.L	A3,A0
	ADDA.W	4(A5),A0
	MOVE.L	A3,A1
	ADDA.W	4(A5),A1
	MOVE.L	(A6)+,A2	;MSK
	MOVE.L	(A6),A6
	JSR	(A6)
	LEA	PAS(A5),A5

	LEA	TABLE_GEN+(36*8),A6	;I
	ADDA.W	2(A5),A6
	MOVE.L	A3,A0
	ADDA.W	4(A5),A0
	MOVE.L	A3,A1
	ADDA.W	4(A5),A1
	MOVE.L	(A6)+,A2	;MSK
	MOVE.L	(A6),A6
	JSR	(A6)
	LEA	PAS(A5),A5

	LEA	TABLE_GEN+(24*8),A6	;R
	ADDA.W	2(A5),A6
	MOVE.L	A3,A0
	ADDA.W	4(A5),A0
	MOVE.L	A3,A1
	ADDA.W	4(A5),A1
	MOVE.L	(A6)+,A2	;MSK
	MOVE.L	(A6),A6
	JSR	(A6)
	LEA	PAS(A5),A5

	LEA	TABLE_GEN+(12*8),A6	;E
	ADDA.W	2(A5),A6
	MOVE.L	A3,A0
	ADDA.W	4(A5),A0
	MOVE.L	A3,A1
	ADDA.W	4(A5),A1
	MOVE.L	(A6)+,A2	;MSK
	MOVE.L	(A6),A6
	JSR	(A6)
	LEA	PAS(A5),A5

	LEA	TABLE_GEN,A6	;Z
	ADDA.W	2(A5),A6
	MOVE.L	A3,A0
	ADDA.W	4(A5),A0
	MOVE.L	A3,A1
	ADDA.W	4(A5),A1
	MOVE.L	(A6)+,A2	;MSK
	MOVE.L	(A6),A6
	JSR	(A6)
	LEA	PAS(A5),A5


	SF	$FFFF8240.W
	BSR	SWAPEC

	ADDQ.L	#6,PNT_CRB

	MOVE.L	PNT_CRB,A0
	CMPI.W	#-1,(PAS*8)-6(A0)
	BNE.S	FINF_ZERIOUL
	MOVE.L	#COURB,PNT_CRB
FINF_ZERIOUL	JSR	ZIK+8
	MOVE	#$777,$FFFF8250.W
;	MOVEM.L	REG_3D,D0-A6
;	MOVE.L	SCREEN2,A2
;	LEA	6(A2),A2
;	ADDQ.L	#1,CNT2
	
;	CMPI.L	#NB_POS,CNT		* ESSAYER 63 !!
;	BNE.S	L

;	LEA	DATA_X,A0
;	LEA	DATA_Y,A1
;	clr.l	CNT
L
;	CMPI.L	#NB_POS,CNT2
;	BNE.S	L2

;	LEA	DATA_Y,A3
;	CLR.L	CNT2
L2
;	ADDQ.L	#1,CNT

;	MOVEQ	#0,D0
	
;	REPT	NB_PTS
;	MOVE	(A3)+,D1
;	MOVE.B	D0,0(A2,D1.W)
;	ENDR

;	REPT	NB_PTS
;	MOVE.B	(A0)+,D0
;	MOVE	(A1)+,D1
;	OR.B	D0,0(A2,D1.W)
;	ENDR
poi
;	MOVEM.L	D0-A6,REG_3D

	CMPI.B	#$1,$FFFFFC02.W
	BEQ	FIN
	CMPI.B	#$3B,$FFFFFC02.W
	BEQ.S	SUITE_DEMO2
	RTE
SUITE_DEMO2
	MOVE	#$2300,SR
	MOVE.L	#VBL_ZIK,$70.W
	JSR	PREP_ECR
	LEA	PIC3,A0
	LEA	DECRUNCHED2,A1
	JSR	decrunch
	JSR	CHANGE_DATAS_DANATO
	JSR	MAK_COD_DANATO
	MOVE.L	#COURB,PNT_CRB
	LEA	DECRUNCHED2+34+96+32,A0
	BSR	PREDECALET
	MOVEM.L	DECRUNCHED2+2,D0-D7
	MOVEM.L	D0-D7,$FFFF8240.W
	JSR	PREP_ECR
	MOVE.L	#VBLR_DANATO,$70.W
LOOPB	JMP	LOOPB

VBLR_DANATO	CMPI.B	#$F,$FFFFFC02.W
	BNE.S	SUIT_DAN
	ST	$FFFF8240.W
SUIT_DAN
	MOVE.L	PNT_CRB,A5
	SUBA.L	#12,A5
	MOVEQ	#0,D0
	MOVEQ	#0,D1
	MOVEQ	#0,D2
	MOVEQ	#0,D3
	MOVEQ	#0,D4
	MOVEQ	#0,D5
	MOVEQ	#0,D6
	MOVEQ	#0,D7
	MOVE.L	#0,A0
	MOVE.L	#0,A1
	MOVE.L	#0,A2
	MOVE.L	#0,A3

	MOVE.L	SCREEN2,A4	;O
	ADDA.W	4(A5),A4
N	SET	0
	REPT	63
	MOVEM.L	D0-D7/A0-A1,N(A4)
N	SET	N+160
	ENDR
	LEA	PAS(A5),A5


;	MOVE.L	SCREEN2,A4	;T
;	ADDA.W	4(A5),A4
;N	SET	0
;	REPT	Y
;	MOVEM.L	D0-D7/A0-A1,N(A4)
;N	SET	N+160
;	ENDR
;	LEA	PAS(A5),A5


	MOVE.L	SCREEN2,A0
	LEA	TABLE_GEN+(36*8),A2
	MOVE.W	2(A5),D1
	MOVE.L	8(A2,D1.W),A1
	ADDA.W	4(A5),A0
	JSR	(A1)
	LEA	PAS(A5),A5

	MOVE.L	#0,A0
	MOVE.L	#0,A1
	MOVEQ	#0,D1






	MOVE.L	SCREEN2,A4	;A
	ADDA.W	4(A5),A4
N	SET	0
	REPT	63
	MOVEM.L	D0-D7/A0-A1,N(A4)
N	SET	N+160
	ENDR
	LEA	PAS(A5),A5

;	MOVE.L	SCREEN2,A4	;N
;	ADDA.W	4(A5),A4
;N	SET	0
;	REPT	Y
;	MOVEM.L	D0-D7/A0-A1,N(A4)
;N	SET	N+160
;	ENDR
;	LEA	PAS(A5),A5
;	LEA	PAS(A5),A5

	MOVE.L	SCREEN2,A4	;N
	ADDA.W	4(A5),A4
N	SET	0
	REPT	63
	MOVEM.L	D0-D7/A0-A1,N(A4)
N	SET	N+160
	ENDR
	LEA	PAS(A5),A5

	MOVE.L	SCREEN2,A4	;A
	ADDA.W	4(A5),A4
N	SET	0
	REPT	63
	MOVEM.L	D0-D7/A0-A1,N(A4)
N	SET	N+160
	ENDR
	LEA	PAS(A5),A5


	MOVE.L	SCREEN2,A4	;D
	ADDA.W	4(A5),A4
N	SET	0
	REPT	63
	MOVEM.L	D0-D7/A0-A1,N(A4)
N	SET	N+160
	ENDR
	LEA	PAS(A5),A5


	*AFFICHAGE EN MOVEM

	MOVE.L	PNT_CRB,A5

	LEA	PREDEC_TAB,A4
	MOVE.W	(A5),D0
	LSR	#1,D0
	MOVE.L	(A4,D0.W),A0
	MOVE.L	SCREEN2,A1
	ADDA.W	4(A5),A1
N	SET	0
	REPT	63
	MOVEM.L	(A0)+,D0-D7/A2-A3
	MOVEM.L	D0-D7/A2-A3,N(A1)
N	SET	N+160
	ENDR

	MOVE.L	PNT_CRB,A5
	LEA	PAS(A5),A5
	MOVE.L	#0,A4

	MOVE.L	SCREEN2,A3

;	LEA	TABLE_GEN+(60*8),A6	;U
;	ADDA.W	2(A5),A6
;	MOVE.L	A3,A0
;	ADDA.W	4(A5),A0
;	MOVE.L	A3,A1
;	ADDA.W	4(A5),A1
;	MOVE.L	(A6)+,A2	;MSK
;	MOVE.L	(A6),A6
;	JSR	(A6)
;	LEA	PAS(A5),A5

;	LEA	TABLE_GEN+(48*8),A6	;O
;	ADDA.W	2(A5),A6
;	MOVE.L	A3,A0
;	ADDA.W	4(A5),A0
;	MOVE.L	A3,A1
;	ADDA.W	4(A5),A1
;	MOVE.L	(A6)+,A2	;MSK
;	MOVE.L	(A6),A6
;	JSR	(A6)
;	LEA	PAS(A5),A5

	LEA	TABLE_GEN+(36*8),A6	;T
	ADDA.W	2(A5),A6
	MOVE.L	A3,A0
	ADDA.W	4(A5),A0
	MOVE.L	A3,A1
	ADDA.W	4(A5),A1
	MOVE.L	(A6)+,A2	;MSK
	MOVE.L	(A6),A6
	JSR	(A6)
	LEA	PAS(A5),A5

	LEA	TABLE_GEN+(12*8),A6	;A
	ADDA.W	2(A5),A6
	MOVE.L	A3,A0
	ADDA.W	4(A5),A0
	MOVE.L	A3,A1
	ADDA.W	4(A5),A1
	MOVE.L	(A6)+,A2	;MSK
	MOVE.L	(A6),A6
	JSR	(A6)
	LEA	PAS(A5),A5



;	LEA	TABLE_GEN+(24*8),A6	;N
;	ADDA.W	2(A5),A6
;	MOVE.L	A3,A0
;	ADDA.W	4(A5),A0
;	MOVE.L	A3,A1
;	ADDA.W	4(A5),A1
;	MOVE.L	(A6)+,A2	;MSK
;	MOVE.L	(A6),A6
;	JSR	(A6)
;	LEA	PAS(A5),A5
;	LEA	PAS(A5),A5
	


	LEA	TABLE_GEN+(24*8),A6	;N
	ADDA.W	2(A5),A6
	MOVE.L	A3,A0
	ADDA.W	4(A5),A0
	MOVE.L	A3,A1
	ADDA.W	4(A5),A1
	MOVE.L	(A6)+,A2	;MSK
	MOVE.L	(A6),A6
	JSR	(A6)
	LEA	PAS(A5),A5

	LEA	TABLE_GEN+(12*8),A6	;A
	ADDA.W	2(A5),A6
	MOVE.L	A3,A0
	ADDA.W	4(A5),A0
	MOVE.L	A3,A1
	ADDA.W	4(A5),A1
	MOVE.L	(A6)+,A2	;MSK
	MOVE.L	(A6),A6
	JSR	(A6)
	LEA	PAS(A5),A5

	LEA	TABLE_GEN,A6	;D
	ADDA.W	2(A5),A6
	MOVE.L	A3,A0
	ADDA.W	4(A5),A0
	MOVE.L	A3,A1
	ADDA.W	4(A5),A1
	MOVE.L	(A6)+,A2	;MSK
	MOVE.L	(A6),A6
	JSR	(A6)
	LEA	PAS(A5),A5


	SF	$FFFF8240.W
	BSR	SWAPEC

	ADDQ.L	#6,PNT_CRB

	MOVE.L	PNT_CRB,A0
	CMPI.W	#-1,(PAS*8)-6(A0)
	BNE.S	FINF_D
	MOVE.L	#COURB,PNT_CRB
FINF_D
	JSR	ZIK+8

	CMPI.B	#$1,$FFFFFC02.W
	BEQ	FIN
	CMPI.B	#$3B,$FFFFFC02.W
	BEQ.S	SUITE_DEMO3
	RTE
SUITE_DEMO3
	MOVE	#$2300,SR
	MOVE.L	#VBL_ZIK,$70.W
	JSR	PREP_ECR
	LEA	PIC4,A0
	LEA	DECRUNCHED2,A1
	JSR	decrunch
	JSR	CHANGE_DATAS_BLYZ
	JSR	MAK_COD_BLYZ
	MOVE.L	#COURB,PNT_CRB
	LEA	DECRUNCHED2+34+58*160,A0
	BSR	PREDECALET
	MOVEM.L	DECRUNCHED2+2,D0-D7
	MOVEM.L	D0-D7,$FFFF8240.W
	JSR	PREP_ECR
	BSR	PRP_CRB
	BSR	PRP_FNT
	BSR	PRP_TXT
	MOVE.L	#BUF_TEXT,PNT_TEXT
	CLR.W	PNT1
	MOVE.L	#MOUVEMENT,PNT_MOV
	LEA	MOUVEMENT,A0
	LEA	ENDED_CRB,A1
	MOVE.L	-8(A1),-8(A0)
	MOVE.L	-4(A1),-4(A0)
	JSR	PREP_ECR
	MOVE.L	#VBLR_BLYZ,$70.W
LOOPC	JMP	LOOPC

VBLR_BLYZ	CMPI.B	#$F,$FFFFFC02.W
	BNE.S	SUIT_BLYZ
	ST	$FFFF8240.W
SUIT_BLYZ
	MOVE.L	PNT_CRB,A5
	SUBA.L	#12,A5
	MOVEQ	#0,D0
	MOVEQ	#0,D1
	MOVEQ	#0,D2
	MOVEQ	#0,D3
	MOVEQ	#0,D4
	MOVEQ	#0,D5
	MOVEQ	#0,D6
	MOVEQ	#0,D7
	MOVE.L	#0,A0
	MOVE.L	#0,A1
	MOVE.L	#0,A2
	MOVE.L	#0,A3

	MOVE.L	SCREEN2,A4	;D
	ADDA.W	4(A5),A4
N	SET	0
	REPT	58-4	OK
	MOVEM.L	D0-D7,N(A4)
N	SET	N+160
	ENDR
	LEA	PAS(A5),A5


	MOVE.L	SCREEN2,A4	;R
	ADDA.W	4(A5),A4
N	SET	0
	REPT	58-3	OK
	MOVEM.L	D0-D7,N(A4)
N	SET	N+160
	ENDR
	LEA	PAS(A5),A5

	MOVE.L	SCREEN2,A4	;A
	ADDA.W	4(A5),A4
N	SET	0
	REPT	58	OK
	MOVEM.L	D0-D7,N(A4)
N	SET	N+160
	ENDR
	LEA	PAS(A5),A5

	MOVE.L	SCREEN2,A4	;Z
	ADDA.W	4(A5),A4
N	SET	0
	REPT	58-3	OK
	MOVEM.L	D0-D7,N(A4)
N	SET	N+160
	ENDR
	LEA	PAS(A5),A5

	MOVE.L	SCREEN2,A4	;Z
	ADDA.W	4(A5),A4
N	SET	0
	REPT	58-3	OK
	MOVEM.L	D0-D7,N(A4)
N	SET	N+160
	ENDR
	LEA	PAS(A5),A5

	MOVE.L	SCREEN2,A4	;Y
	ADDA.W	4(A5),A4
N	SET	0
	REPT	58-3
	MOVEM.L	D0-D7,N(A4)
N	SET	N+160
	ENDR
	LEA	PAS(A5),A5

	MOVE.L	SCREEN2,A4	;L
	ADDA.W	4(A5),A4
N	SET	0
	REPT	58-4
	MOVEM.L	D0-D7,N(A4)
N	SET	N+160
	ENDR
	LEA	PAS(A5),A5

	MOVE.L	SCREEN2,A4	;B
	ADDA.W	4(A5),A4
N	SET	0
	REPT	58-3
	MOVEM.L	D0-D7,N(A4)
N	SET	N+160
	ENDR
	LEA	PAS(A5),A5

	*AFFICHAGE EN MOVEM

	MOVE.L	PNT_CRB,A5

	LEA	PREDEC_TAB,A4
	MOVE.W	(A5),D0
	LSR	#1,D0
	MOVE.L	(A4,D0.W),A0
	MOVE.L	SCREEN2,A1
	ADDA.W	4(A5),A1
N	SET	0
	REPT	58-4	OK
	MOVEM.L	(A0)+,D0-D7
	MOVEM.L	D0-D7,N(A1)
N	SET	N+160
	ENDR

	MOVE.L	PNT_CRB,A5
	LEA	PAS(A5),A5
	MOVE.L	#0,A4

	MOVE.L	SCREEN2,A3

	LEA	TABLE_GEN+(60*8),A6	;R
	ADDA.W	2(A5),A6
	MOVE.L	A3,A0
	ADDA.W	4(A5),A0
	MOVE.L	A3,A1
	ADDA.W	4(A5),A1
	MOVE.L	(A6)+,A2	;MSK
	MOVE.L	(A6),A6
	JSR	(A6)
	LEA	PAS(A5),A5

	LEA	TABLE_GEN+(48*8),A6	;A
	ADDA.W	2(A5),A6
	MOVE.L	A3,A0
	ADDA.W	4(A5),A0
	MOVE.L	A3,A1
	ADDA.W	4(A5),A1
	MOVE.L	(A6)+,A2	;MSK
	MOVE.L	(A6),A6
	JSR	(A6)
	LEA	PAS(A5),A5

	LEA	TABLE_GEN+(36*8),A6	;Z
	ADDA.W	2(A5),A6
	MOVE.L	A3,A0
	ADDA.W	4(A5),A0
	MOVE.L	A3,A1
	ADDA.W	4(A5),A1
	MOVE.L	(A6)+,A2	;MSK
	MOVE.L	(A6),A6
	JSR	(A6)
	LEA	PAS(A5),A5

	LEA	TABLE_GEN+(36*8),A6	;Z
	ADDA.W	2(A5),A6
	MOVE.L	A3,A0
	ADDA.W	4(A5),A0
	MOVE.L	A3,A1
	ADDA.W	4(A5),A1
	MOVE.L	(A6)+,A2	;MSK
	MOVE.L	(A6),A6
	JSR	(A6)
	LEA	PAS(A5),A5

	LEA	TABLE_GEN+(24*8),A6	;Y
	ADDA.W	2(A5),A6
	MOVE.L	A3,A0
	ADDA.W	4(A5),A0
	MOVE.L	A3,A1
	ADDA.W	4(A5),A1
	MOVE.L	(A6)+,A2	;MSK
	MOVE.L	(A6),A6
	JSR	(A6)
	LEA	PAS(A5),A5

	LEA	TABLE_GEN+(12*8),A6	;L
	ADDA.W	2(A5),A6
	MOVE.L	A3,A0
	ADDA.W	4(A5),A0
	MOVE.L	A3,A1
	ADDA.W	4(A5),A1
	MOVE.L	(A6)+,A2	;MSK
	MOVE.L	(A6),A6
	JSR	(A6)
	LEA	PAS(A5),A5

	LEA	TABLE_GEN,A6	;B
	ADDA.W	2(A5),A6
	MOVE.L	A3,A0
	ADDA.W	4(A5),A0
	MOVE.L	A3,A1
	ADDA.W	4(A5),A1
	MOVE.L	(A6)+,A2	;MSK
	MOVE.L	(A6),A6
	JSR	(A6)
	LEA	PAS(A5),A5



	ADDQ.L	#6,PNT_CRB

	MOVE.L	PNT_CRB,A0
	CMPI.W	#-1,(PAS*8)-6(A0)
	BNE.S	FINF_B
	MOVE.L	#COURB,PNT_CRB
FINF_B	JSR	ZIK+8

	BSR	TEST
	ADDQ.W	#4,PNT1
	CMPI.W	#32,PNT1
	BNE.S	SUIT1
	CLR.W	PNT1
	ADDQ.L	#4,PNT_TEXT
SUIT1	MOVE.L	PNT_TEXT,A0
	CMPI.L	#-1,4*18(A0)
	BNE.S	SUIT2
	MOVE.L	#BUF_TEXT,PNT_TEXT
SUIT2	ADDQ.L	#4,PNT_MOV
	MOVE.L	PNT_MOV,A0
	CMPI.L	#-1,(A0)
	BNE.S	SUIT3
	MOVE.L	#MOUVEMENT,PNT_MOV
SUIT3	
	SF	$FFFF8240.W
	BSR	SWAPEC
	
	LEA	COLORS_FOR_THE_CIRCLE,A0
	ADDA.L	PNT_COLOR,A0
	CMPI	#-1,(A0)
	BNE.S	THATSOK
	LEA	COLORS_FOR_THE_CIRCLE,A0
	CLR.L	PNT_COLOR
THATSOK	
	MOVE	(A0),$FFFF8250.W
	MOVE	(A0),$FFFF8252.W
	MOVE	(A0),$FFFF8254.W
	MOVE	(A0),$FFFF8256.W
	MOVE	(A0),$FFFF8258.W
	MOVE	(A0),$FFFF825A.W
	MOVE	(A0),$FFFF825C.W
	MOVE	(A0),$FFFF825E.W
	ADDQ.L	#2,PNT_COLOR
	
	CMPI.B	#$39,$FFFFFC02.W
	BEQ	FIN
	RTE

TEST	MOVE.L	PNT_MOV,A2
	SUBQ.L	#8,A2
	MOVE.L	SCREEN2,A0
	LEA	6(A0),A0
	ADDA.W	2(A2),A0
	MOVEQ	#0,D0
	JSR	EFFAC
	MOVE.L	PNT_MOV,A0
	MOVE.L	SCREEN2,A1
	LEA	6(A1),A1
	ADDA.W	2(A0),A1
	MOVEQ	#0,D0
	MOVE.W	(A0),D0
	LEA	COURT_TABL,A0
	MOVE.L	0(A0,D0.W),A0
	MOVE.L	PNT_TEXT,A2
	MOVE.L	(A2)+,A3
	ADDA.W	PNT1,A3
	MOVE.L	(A3),A3
	JSR	(A3)
	REPT	15
	MOVE.L	(A2)+,A3
	MOVE.L	(A3),A3
	JSR	(A3)
	ENDR
	CLR.W	(A1)
	RTS

VBL_ZIK	MOVEM.L	D0-A6,-(SP)
	JSR	ZIK+8
	MOVEM.L	(SP)+,D0-A6
	CMPI.B	#$1,$FFFFFC02.W
	BEQ	FIN
	RTE

TB0	BCLR	#0,$FFFFFA0F.W
	RTE

SWAPEC	MOVE.L	SCREEN1,D0
	MOVE.L	SCREEN2,SCREEN1
	MOVE.L	D0,SCREEN2
	MOVE.B	SCREEN1+1,$FFFF8201.W
	MOVE.B	SCREEN1+2,$FFFF8203.W
	RTS
	
MAK_COD	MOVE.L	#TABLE_SPR,ANNEX
	LEA	BUF_COD,A2
	LEA	TABLE_GEN,A6
	LEA	FIC_OPT,A3	;OPT POUR LE SPRITE(MASK-SPRITE)
	BSR 	CODING
	ADDQ.L	#4,ANNEX
	LEA	FIC_OPT+512,A3
	BSR	CODING
	ADDQ.L	#4,ANNEX
	LEA	FIC_OPT+1024,A3
	BSR	CODING
	RTS
MAK_COD_ZERIOUL
	MOVE.L	#TABLE_SPR_ZERIOUL,ANNEX
	LEA	BUF_COD,A2
	LEA	TABLE_GEN,A6
	LEA	FIC_OPT2,A3	
	CLR.W	FLAG_EFF
	BSR 	CODING	;Z
	ADDQ.L	#4,ANNEX
	LEA	FIC_OPT2+512,A3
	CLR.W	FLAG_EFF
	BSR	CODING	;E
	ADDQ.L	#4,ANNEX
	LEA	FIC_OPT2+1024,A3
	CLR.W	FLAG_EFF
	BSR	CODING	;R
	ADDQ.L	#4,ANNEX
	LEA	FIC_OPT2+1536,A3
	MOVE.W	#1,FLAG_EFF
	BSR	CODING	;I
	ADDQ.L	#4,ANNEX
	LEA	FIC_OPT2+2048,A3
	CLR.W	FLAG_EFF
	BSR	CODING	;O
	ADDQ.L	#4,ANNEX
	LEA	FIC_OPT2+2560,A3
	CLR.W	FLAG_EFF
	BSR	CODING	;U
	RTS

MAK_COD_DANATO	MOVE.L	#TABLE_SPR_DANATO,ANNEX
	LEA	BUF_COD,A2
	LEA	TABLE_GEN,A6
	LEA	FIC_OPT3,A3	;OPT POUR LE SPRITE(MASK-SPRITE)
	CLR.W	FLAG_EFF
	BSR 	CODING	;D

	ADDQ.L	#4,ANNEX
	LEA	FIC_OPT3+512,A3
	CLR.W	FLAG_EFF
	BSR	CODING	;A

	ADDQ.L	#4,ANNEX
	LEA	FIC_OPT3+1024,A3
	CLR.W	FLAG_EFF
	BSR	CODING	;N

	ADDQ.L	#4,ANNEX
	LEA	FIC_OPT3+1536,A3
	MOVE	#1,FLAG_EFF
	BSR	CODING	;T

	RTS

MAK_COD_BLYZ	MOVE.L	#TABLE_SPR_BLYZ,ANNEX
	LEA	BUF_COD,A2
	LEA	TABLE_GEN,A6

	LEA	FIC_OPT4,A3	;OPT POUR LE SPRITE(MASK-SPRITE)
	CLR.W	FLAG_EFF
	BSR 	CODING	;B
	ADDQ.L	#4,ANNEX

	LEA	FIC_OPT4+512,A3
	CLR.W	FLAG_EFF
	BSR	CODING	;L
	ADDQ.L	#4,ANNEX

	LEA	FIC_OPT4+1024,A3
	CLR.W	FLAG_EFF
	BSR	CODING	;Y
	ADDQ.L	#4,ANNEX

	LEA	FIC_OPT4+1536,A3
	CLR	FLAG_EFF
	BSR	CODING	;Z
	ADDQ.L	#4,ANNEX

	LEA	FIC_OPT4+2048,A3
	CLR.W	FLAG_EFF
	BSR	CODING	;A
	ADDQ.L	#4,ANNEX

	LEA	FIC_OPT4+2560,A3
	CLR.W	FLAG_EFF
	BSR	CODING	;R
	RTS

CODING	
RECOMGENSPR	MOVE.L	ANNEX,A0
	MOVE.L	(A0),A0
	MOVE.L	SCREEN1,A1
	MOVE.L	SCREEN2,A5
CHANGEY1	MOVE.W	#81-1,D6
CHANGE1
REAF2	MOVE.W	#6-2,D7
REAF1	MOVE.L	(A0),(A1)+
	MOVE.L	4(A0),(A1)+
	MOVE.W	(A0),D0
	MOVE.W	2(A0),D1
	MOVE.W	4(A0),D2
	OR.W	D2,D0
	OR.W	D1,D0
	NOT.W	D0
	MOVE.W	D0,(A5)+
	ADDQ.L	#8,A0
	DBRA	D7,REAF1
	CLR.L	(A1)+
	CLR.L	(A1)+
	MOVE.W	#-1,(A5)+
CHANGE2	LEA	160-((6-1)*8)(A0),A0
	DBRA	D6,REAF2

	MOVE.L	A3,(A6)+
	MOVE.L	A2,(A6)+
	BSR	COD_GEN
	MOVE.L	A2,(A6)+
	BSR	MAK_EFF
	REPT	NB_DECAL-1
	BSR	DECAL_SPR
	MOVE.L	A3,(A6)+
	MOVE.L	A2,(A6)+
	BSR	COD_GEN
	MOVE.L	A2,(A6)+
	BSR	MAK_EFF
	ENDR
	RTS

DECAL_SPR	MOVE.L	SCREEN2,A1	;MSK
	MOVE.W	#NB_DEC,D4
RECOM_DEC	MOVE.L	SCREEN1,A0	;SPR
CHANGEY2	MOVE.W	#81-1,D5
DEC3	MOVE.W	#3,D6
CHANGE3
DEC2	MOVE.W	#6-1,D7
DEC1	ROXR	(A0)
	ADDQ.L	#8,A0
	DBRA	D7,DEC1
CHANGE4	LEA	-((6*8)-2)(A0),A0
	DBRA	D6,DEC2
CHANGE5	LEA	(6-1)*8(A0),A0
	DBRA	D5,DEC3
	DBRA	D4,RECOM_DEC
	MOVE.L	SCREEN1,A0
CHANGEY3	MOVE.W	#81-1,D6
CHANGE6
MSK2	MOVE.W	#6-1,D7
MSK1	MOVE.W	(A0)+,D0
	MOVE.W	(A0)+,D1
	MOVE.W	(A0)+,D2
	ADDQ.L	#2,A0
	OR.W	D1,D0
	OR.W	D2,D0
	NOT.W	D0
	MOVE.W	D0,(A1)+
	DBRA	D7,MSK1
	DBRA	D6,MSK2
	RTS

COD_GEN	MOVE.L	SCREEN1,A0	;SPR
	MOVE.L	SCREEN2,A1	;MSK
	MOVE.L	#$4CDA00FF,(A2)+
CHANGEY4	MOVE.W	#81-1,D6
CHANGE7	
CDG2	MOVE.W	#6-1,D7
CDG1	BSR	ANDS
	DBRA	D7,CDG1
	MOVE.W	#$41E8,(A2)+
CHANGE8	MOVE.W	#160-(6*8),(A2)+
	BSR	OPTI_ADDQ_ANDS
 	DBRA	D6,CDG2
	LEA	32(A3),A3
	MOVE.L	SCREEN1,A0	;SPR
	MOVE.L	SCREEN2,A1	;MSK
	MOVE.L	#$4CDA00FF,(A2)+
CHANGEY5	MOVE.W	#81-1,D6
CHANGE9
CDG4	MOVE.W	#6-1,D7
CDG3	BSR	ORS
	DBRA	D7,CDG3
	MOVE.W	#$43E9,(A2)+
CHANGE10	MOVE.W	#160-(6*8),(A2)+
	BSR	OPTI_ADDQ_ORS
	DBRA	D6,CDG4
	LEA	32(A3),A3
	MOVE.W	#$4E75,(A2)+
	RTS

ANDS	TST.W	(A1)
	BEQ.S	NO_MASK
	CMPI.W	#-1,(A1)
	BEQ.S	NO_MASK
	;TST.L	0(A0)
	;BEQ	AND1
	MOVE.W	#$C158,D4
	MOVE.W	#$C198,D5
	CLR.W	ADD1
	MOVE.W	(A1),D0
	MOVE.W	#7,D3
CHERCHMSK	CMP.W     	(A3),D0
	BEQ.S	MSKTROUVê
	ADDQ.L	#4,A3
	ADDI.W	#$200,D4
	ADDI.W	#$200,D5
	ADDQ.W	#4,ADD1
	DBRA	D3,CHERCHMSK
	LEA	-32(A3),A3
	MOVE.W	#$0298,(A2)+
	MOVE.W	(A1),(A2)+
	MOVE.W	(A1),(A2)+
	MOVE.W	#$0258,(A2)+
	MOVE.W	(A1),(A2)+
	MOVE.W	#$5448,(A2)+
;	ADDQ.W	#1,ADD
	BRA.S	FIN_MASK
MSKTROUVê	SUBA.W	ADD1,A3
	MOVE.W	D5,(A2)+
	MOVE.W	D4,(A2)+
	MOVE.W	#$5448,(A2)+
;	ADDQ.W	#1,ADD
	BRA.S	FIN_MASK
NO_MASK	MOVE.W	#$5048,(A2)+
	BSR	OPTI_ADDQ_ANDS
;	ADDQ.W	#1,ADD
FIN_MASK	ADDQ.L	#2,A1
	ADDQ.L	#8,A0
	RTS

AND1	MOVE.W	#$0258,(A2)+
	MOVE.W	(A1),(A2)+
	MOVE.W	#$5C48,(A2)+
	BRA	FIN_MASK

OPTI_ADDQ_ANDS:
	CLR.W	VARI
	MOVE.W	#$5048,D1	;ADDQ.W	#8,A0
	MOVE.W	#$5448,D2	;ADDQ.W	#2,A0
	MOVE.W	#$41E8,D3	;LEA	#IMM(A0),A0
CONTANDQ	CMP.W	-2(A2),D1
	BNE.S	ANDQ2
	ADDQ.W	#8,VARI
	SUBQ.L	#2,A2
	BRA	CONTANDQ
ANDQ2	CMP.W	-2(A2),D2
	BNE.S	ANDQ3
	ADDQ.W	#2,VARI
	SUBQ.L	#2,A2
	BRA	CONTANDQ
ANDQ3	CMP.W	-4(A2),D3
	BNE.S	FINANDQ
	MOVE.W	-2(A2),D4
	ADD.W	D4,VARI
	SUBQ.L	#4,A2
	BRA	CONTANDQ
FINANDQ	TST.W	VARI
	BEQ	SORTANDQ
	CMPI.W	#8,VARI
	BGT	CHANDQ2
	CMPI.W	#2,VARI
	BNE.S	CH1
	MOVE.W	#$5448,(A2)+
	BRA.S	SORTANDQ
CH1	CMPI.W	#4,VARI
	BNE.S	CH11
	MOVE.W	#$5848,(A2)+
	BRA.S	SORTANDQ
CH11	CMPI.W	#6,VARI
	BNE.S	CH111
	MOVE.W	#$5C48,(A2)+
	BRA.S	SORTANDQ
CH111	MOVE.W	#$5048,(A2)+
	BRA.S	SORTANDQ
CHANDQ2	MOVE.W	#$41E8,(A2)+
	MOVE.W	VARI,(A2)+
SORTANDQ	RTS

OPTI_ADDQ_ORS:
	CLR.W	VARI
	MOVE.W	#$5449,D0
	MOVE.W	#$5849,D1
	MOVE.W	#$5C49,D2
	MOVE.W	#$5049,D3
	MOVE.W	#$43E9,D4
CONTORQ	CMP.W	-2(A2),D0
	BNE.S	ORQ2
	ADDQ.W	#2,VARI
	SUBQ.L	#2,A2
	BRA.S	CONTORQ
ORQ2	CMP.W	-2(A2),D1
	BNE.S	ORQ3
	ADDQ.W	#4,VARI
	SUBQ.L	#2,A2
	BRA.S	CONTORQ
ORQ3	CMP.W	-2(A2),D2
	BNE.S	ORQ4
	ADDQ.W	#6,VARI
	SUBQ.L	#2,A2
	BRA.S	CONTORQ
ORQ4	CMP.W	-2(A2),D3
	BNE.S	ORQ5
	ADDQ.W	#8,VARI
	SUBQ.L	#2,A2
	BRA.S	CONTORQ
ORQ5	CMP.W	-4(A2),D4
	BNE.S	SORTORQ
	MOVE.W	-2(A2),D0
	ADD.W	D0,VARI
	MOVE.W	#$5449,D0
	SUBQ.L	#4,A2
	BRA.S	CONTORQ
SORTORQ	TST.W	VARI
	BEQ	FINORQ
	CMPI.W	#8,VARI
	BGT	CHORQ2
	CMPI.W	#2,VARI
	BNE.S	ORQ11
	MOVE.W	#$5449,(A2)+
	BRA	FINORQ
ORQ11	CMPI.W	#4,VARI
	BNE.S	ORQ111
	MOVE.W	#$5849,(A2)+
	BRA	FINORQ
ORQ111	CMPI.W	#6,VARI
	BNE.S	ORQ1111
	MOVE.W	#$5C49,(A2)+
	BRA	FINORQ
ORQ1111	MOVE.W	#$5049,(A2)+
	BRA	FINORQ
CHORQ2	MOVE.W	#$43E9,(A2)+
	MOVE.W	VARI,(A2)+
FINORQ	RTS

ORS	TST.W	(A1)
	BEQ	AFF_MOV
	CMPI.W	#-1,(A1)
	BEQ	NO_AFF
	TST.L	(A0)
	BEQ	AFF3
	TST.L	2(A0)
	BEQ	AFF1
	TST.W	(A0)
	BEQ	AFF23
	TST.W	4(A0)
	BEQ	AFF12
;	TST.W	2(A0)
;	BEQ	AFF13
	MOVEQ	#0,D0
	MOVE.W	(A0),D0
	CMP.W	2(A0),D0
	BEQ	COMPARE1
	BRA	NOT1SAME
APRES1COMP	MOVEQ	#0,D0
	MOVE.W	4(A0),D0
	CLR.W	ADD1
	MOVE.W	#$8159,D4
	MOVE.W	#7,D3
CHERCHSP1	CMP.L	(A3),D0
	BEQ.S	TROUVê1
	ADDQ.W	#4,ADD1
	ADDQ.L	#4,A3
	ADDI.W	#$200,D4
	DBRA	D3,CHERCHSP1
	LEA	-32(A3),A3
	MOVE.W	#$0059,(A2)+
	MOVE.W	4(A0),(A2)+
	MOVE.W	#$5449,(A2)+
;	ADDQ.W	#1,ADD
	BRA	FIN_AFF
TROUVê1	SUBA.W	ADD1,A3
	MOVE.W	D4,(A2)+
	MOVE.W	#$5449,(A2)+
;	ADDQ.W	#1,ADD
	BRA	FIN_AFF

COMPARE1	CLR.W	ADD1
	SWAP	D0
	MOVE.W	2(A0),D0
	MOVE.W	#$8199,D4
	MOVE.W	#7,D3
CHERCHCOMP1	CMP.L	(A3),D0
	BEQ.S	TROUVêC1
	ADDQ.W	#4,ADD1
	ADDQ.L	#4,A3
	ADDI.W	#$200,D4
	DBRA	D3,CHERCHCOMP1
	LEA	-32(A3),A3
	MOVE.W	#$0099,(A2)+
	MOVE.L	(A0),(A2)+
	BRA	APRES1COMP
TROUVêC1	SUBA.W	ADD1,A3
	MOVE.W	D4,(A2)+
	BRA	APRES1COMP

NOT1SAME	MOVE.W	(A0),D0
	CLR.W	ADD1
	MOVE.W	#$8159,D4
	MOVE.W	#7,D3
CHERCHSPA	CMP.L	(A3),D0
	BEQ.S	TROUVêA
	ADDQ.W	#4,ADD1
	ADDQ.L	#4,A3
	ADDI.W	#$200,D4
	DBRA	D3,CHERCHSPA
	LEA	-32(A3),A3
	MOVE.W	#$0099,(A2)+
	MOVE.L	(A0),(A2)+
	BRA	APRES1COMP
TROUVêA	SUBA.W	ADD1,A3
	MOVE.W	D4,(A2)+
	MOVE.W	2(A0),D0
	CLR.W	ADD1
	MOVE.W	#$8159,D4
	MOVE.W	#7,D3
CHERCHSPB	CMP.L	(A3),D0
	BEQ.S	TROUVêB
	ADDQ.W	#4,ADD1
	ADDQ.L	#4,A3
	ADDI.W	#$200,D4
	DBRA	D3,CHERCHSPB
	LEA	-32(A3),A3
	MOVE.W	#$0059,(A2)+
	MOVE.W	2(A0),(A2)+
	BRA	APRES1COMP
TROUVêB	SUBA.W	ADD1,A3
	MOVE.W	D4,(A2)+
	BRA	APRES1COMP


AFF13	MOVEQ	#0,D0
	MOVE.W	(A0),D0
	CLR.W	ADD1
	MOVE.W	#$8159,D4
	MOVE.W	#7,D3
CHERCHSP13	CMP.L	(A3),D0
	BEQ.S	TROUVê13
	ADDQ.W	#4,ADD1
	ADDQ.L	#4,A3
	ADDI.W	#$200,D4
	DBRA	D3,CHERCHSP13
	LEA	-32(A3),A3
	MOVE.W	#$0059,(A2)+
	MOVE.W	(A0),(A2)+
	MOVE.W	#$5449,(A2)+
;	ADDQ.W	#1,ADD
	BRA	CONT2
TROUVê13	SUBA.W	ADD1,A3
	MOVE.W	D4,(A2)+
	MOVE.W	#$5449,(A2)+
;	ADDQ.W	#1,ADD

CONT2	MOVEQ	#0,D0
	MOVE.W	4(A0),D0
	CLR.W	ADD1
	MOVE.W	#$8159,D4
	MOVE.W	#7,D3
CHERCHSP1_3	CMP.L	(A3),D0
	BEQ.S	TROUVê1_3
	ADDQ.W	#4,ADD1
	ADDQ.L	#4,A3
	ADDI.W	#$200,D4
	DBRA	D3,CHERCHSP1_3
	LEA	-32(A3),A3
	MOVE.W	#$0059,(A2)+
	MOVE.W	4(A0),(A2)+
	MOVE.W	#$5449,(A2)+
;	ADDQ.W	#1,ADD
	BRA	FIN_AFF
TROUVê1_3	SUBA.W	ADD1,A3
	MOVE.W	D4,(A2)+
	MOVE.W	#$5449,(A2)+
;	ADDQ.W	#1,ADD
	
	BRA	FIN_AFF

AFF3	MOVE.W	#$5849,(A2)+
	BSR	OPTI_ADDQ_ORS
;	ADDQ.W	#1,ADD
	MOVEQ	#0,D0
	MOVE.W	4(A0),D0
	CLR.W	ADD1
	MOVE.W	#$8159,D4
	MOVE.W	#7,D3
CHERCHSP3	CMP.L	(A3),D0
	BEQ.S	TROUVê3
	ADDQ.W	#4,ADD1
	ADDQ.L	#4,A3
	ADDI.W	#$200,D4
	DBRA	D3,CHERCHSP3
	LEA	-32(A3),A3
	MOVE.W	#$0059,(A2)+
	MOVE.W	4(A0),(A2)+
	MOVE.W	#$5449,(A2)+
;	ADDQ.W	#1,ADD
	BRA	FIN_AFF
TROUVê3	SUBA.W	ADD1,A3
	MOVE.W	D4,(A2)+
	MOVE.W	#$5449,(A2)+
;	ADDQ.W	#1,ADD
	BRA	FIN_AFF

AFF1	MOVEQ	#0,D0
	MOVE.W	(A0),D0
	CLR.W	ADD1
	MOVE.W	#$8159,D4
	MOVE.W	#7,D3
CHERCHSP11	CMP.L	(A3),D0
	BEQ.S	TROUVê11
	ADDQ.W	#4,ADD1
	ADDQ.L	#4,A3
	ADDI.W	#$200,D4
	DBRA	D3,CHERCHSP11
	LEA	-32(A3),A3
	MOVE.W	#$0059,(A2)+
	MOVE.W	(A0),(A2)+
	MOVE.W	#$5C49,(A2)+
;	ADDQ.W	#1,ADD
	BRA	FIN_AFF
TROUVê11	SUBA.W	ADD1,A3
	MOVE.W	D4,(A2)+
	MOVE.W	#$5C49,(A2)+
;	ADDQ.W	#1,ADD
	BRA	FIN_AFF

AFF12	MOVEQ	#0,D0
	MOVE.W	(A0),D0
	CMP.W	2(A0),D0
	BEQ	COMPARE2
	MOVE.W	#$0099,(A2)+
	MOVE.L	(A0),(A2)+
APRES2COMP	MOVE.W	#$5849,(A2)+
;	ADDQ.W	#1,ADD
	BRA	FIN_AFF

COMPARE2	CLR.W	ADD1
	MOVE.W	#$8159,D4
	MOVE.W	#7,D3
CHERCHCOMP2	CMP.L	(A3),D0
	BEQ.S	TROUVêC2
	ADDQ.W	#4,ADD1
	ADDQ.L	#4,A3
	ADDI.W	#$200,D4
	DBRA	D3,CHERCHCOMP2
	LEA	-32(A3),A3
	MOVE.W	#$0099,(A2)+
	MOVE.L	(A0),(A2)+
	BRA	APRES2COMP
TROUVêC2	SUBA.W	ADD1,A3
	MOVE.W	D4,(A2)+
	MOVE.W	D4,(A2)+
	BRA	APRES2COMP

AFF23	BSR	OPTI_ADDQ_ORS
	MOVE.W	#$5449,(A2)+
;	ADDQ.W	#1,ADD
	TST.W	4(A0)
	BEQ	AFF2
	MOVE.W	#$0099,(A2)+
	MOVE.L	2(A0),(A2)+
	MOVE.W	#$5449,(A2)+
;	ADDQ.W	#1,ADD
	BRA	FIN_AFF
AFF2	MOVEQ	#0,D0
	MOVE.W	2(A0),D0
	CLR.W	ADD1
	MOVE.W	#$8159,D4
	MOVE.W	#7,D3
CHERCHSP2	CMP.L	(A3),D0
	BEQ.S	TROUVê2
	ADDQ.W	#4,ADD1
	ADDQ.L	#4,A3
	ADDI.W	#$200,D4
	DBRA	D3,CHERCHSP2
	LEA	-32(A3),A3
	MOVE.W	#$0059,(A2)+
	MOVE.W	2(A0),(A2)+
	MOVE.W	#$5849,(A2)+
;	ADDQ.W	#1,ADD
	BRA	FIN_AFF
TROUVê2	SUBA.W	ADD1,A3
	MOVE.W	D4,(A2)+
	MOVE.W	#$5849,(A2)+
;	ADDQ.W	#1,ADD
	BRA	FIN_AFF

AFF_MOV	TST.L	(A0)
	BEQ	MOV3
;	TST.L	2(A0)
;	BEQ	MOV1
	TST.W	(A0)
	BEQ	MOV23
	TST.W	4(A0)
	BEQ	MOV12
;	TST.W	2(A0)
;	BEQ	MOV13
	MOVE.W	(A0),D0
	CMP.W	2(A0),D0
	BEQ	COMPARE3
	MOVE.W	(A0),D0
	CLR.W	ADD1
	MOVE.W	#$32C0,D4
	MOVE.W	#7,D3
CHERCHMV66	CMP.L	(A3),D0
	BEQ.S	TROUVêMV66
	ADDQ.L	#4,A3
	ADDQ.W	#4,ADD1
	ADDQ.W	#1,D4
	DBRA	D3,CHERCHMV66
	LEA	-32(A3),A3
	BRA	CONT6
TROUVêMV66	SUBA.W	ADD1,A3
	MOVE.W	D4,(A2)+

	MOVE.W	2(A0),D0
	CLR.W	ADD1
	MOVE.W	#$32C0,D4
	MOVE.W	#7,D3
CHERCHMV77	CMP.L	(A3),D0
	BEQ.S	TROUVêMV77
	ADDQ.L	#4,A3
	ADDQ.W	#4,ADD1
	ADDQ.W	#1,D4
	DBRA	D3,CHERCHMV77
	LEA	-32(A3),A3
	MOVE.W	#$32FC,(A2)+
	MOVE.W	2(A0),(A2)+
	BRA	APRES3COMP
TROUVêMV77	SUBA.W	ADD1,A3
	MOVE.W	D4,(A2)+
	BRA	APRES3COMP

CONT6	MOVE.W	#$22FC,(A2)+
	MOVE.L	(A0),(A2)+
APRES3COMP	MOVEQ	#0,D0
	MOVE.W	4(A0),D0
	CLR.W	ADD1
	MOVE.W	#$32C0,D4
	MOVE.W	#7,D3
CHERCHMV33	CMP.L	(A3),D0
	BEQ.S	TROUVêMV33
	ADDQ.L	#4,A3
	ADDQ.W	#4,ADD1
	ADDQ.W	#1,D4
	DBRA	D3,CHERCHMV33
	LEA	-32(A3),A3
	MOVE.W	#$32FC,(A2)+
	MOVE.W	4(A0),(A2)+
	MOVE.W	#$5449,(A2)+
;	ADDQ.W	#1,ADD
	BRA	FIN_AFF
TROUVêMV33	SUBA.W	ADD1,A3
	MOVE.W	D4,(A2)+
	MOVE.W	#$5449,(A2)+
;	ADDQ.W	#1,ADD
	BRA	FIN_AFF

COMPARE3	SWAP	D0
	MOVE.W	2(A0),D0
	CLR.W	ADD1
	MOVE.W	#$22C0,D4
	MOVE.W	#7,D3
CHERCHCOMP3	CMP.L	(A3),D0
	BEQ.S	TROUVêC3
	ADDQ.W	#4,ADD1
	ADDQ.L	#4,A3
	ADDI.W	#1,D4
	DBRA	D3,CHERCHCOMP3
	LEA	-32(A3),A3
	MOVE.W	#$22FC,(A2)+
	MOVE.L	(A0),(A2)+
	BRA	APRES3COMP
TROUVêC3	SUBA.W	ADD1,A3
	MOVE.W	D4,(A2)+
	BRA	APRES3COMP


MOV13	MOVEQ	#0,D0
	MOVE.W	(A0),D0
	CLR.W	ADD1
	MOVE.W	#$32C0,D4
	MOVE.W	#7,D3
CHERCHMV13	CMP.L	(A3),D0
	BEQ.S	TROUVêMV13
	ADDQ.L	#4,A3
	ADDQ.W	#4,ADD1
	ADDQ.W	#1,D4
	DBRA	D3,CHERCHMV13
	LEA	-32(A3),A3
	MOVE.W	#$32FC,(A2)+
	MOVE.W	(A0),(A2)+
	MOVE.W	#$32CC,(A2)+
	BRA	CONT3
TROUVêMV13	SUBA.W	ADD1,A3
	MOVE.W	D4,(A2)+
	MOVE.W	#$32CC,(A2)+
CONT3	MOVEQ	#0,D0
	MOVE.W	4(A0),D0
	CLR.W	ADD1
	MOVE.W	#$32C0,D4
	MOVE.W	#7,D3
CHERCHMV1_3	CMP.L	(A3),D0
	BEQ.S	TROUVêMV1_3
	ADDQ.L	#4,A3
	ADDQ.W	#4,ADD1
	ADDQ.W	#1,D4
	DBRA	D3,CHERCHMV1_3
	LEA	-32(A3),A3
	MOVE.W	#$32FC,(A2)+
	MOVE.W	(A0),(A2)+
	MOVE.W	#$5449,(A2)+
;	ADDQ.W	#1,ADD
	BRA	FIN_AFF
TROUVêMV1_3	SUBA.W	ADD1,A3
	MOVE.W	D4,(A2)+
	MOVE.W	#$5449,(A2)+
;	ADDQ.W	#1,ADD
	BRA	FIN_AFF
MOV3	MOVE.W	#$22CC,(A2)+
	MOVEQ	#0,D0
	MOVE.W	4(A0),D0
	CLR.W	ADD1
	MOVE.W	#$32C0,D4
	MOVE.W	#7,D3
CHERCHMV3	CMP.L	(A3),D0
	BEQ.S	TROUVêMV3
	ADDQ.L	#4,A3
	ADDQ.W	#4,ADD1
	ADDQ.W	#1,D4
	DBRA	D3,CHERCHMV3
	LEA	-32(A3),A3
	MOVE.W	#$32FC,(A2)+
	MOVE.W	4(A0),(A2)+
	MOVE.W	#$5449,(A2)+
;	ADDQ.W	#1,ADD
	BRA	FIN_AFF
TROUVêMV3	SUBA.W	ADD1,A3
	MOVE.W	D4,(A2)+
	MOVE.W	#$5449,(A2)+
;	ADDQ.W	#1,ADD
	BRA	FIN_AFF
MOV1	MOVEQ	#0,D0
	MOVE.W	(A0),D0
	CLR.W	ADD1
	MOVE.W	#$32C0,D4
	MOVE.W	#7,D3
CHERCHMV1	CMP.L	(A3),D0
	BEQ.S	TROUVêMV1
	ADDQ.L	#4,A3
	ADDQ.W	#4,ADD1
	ADDQ.W	#1,D4
	DBRA	D3,CHERCHMV1
	LEA	-32(A3),A3
	MOVE.W	#$32FC,(A2)+
	MOVE.W	4(A0),(A2)+
	MOVE.W	#$22CC,(A2)+
	MOVE.W	#$5449,(A2)+
;	ADDQ.W	#1,ADD
	BRA	FIN_AFF
TROUVêMV1	SUBA.W	ADD1,A3
	MOVE.W	D4,(A2)+
	MOVE.W	#$22CC,(A2)+
	MOVE.W	#$5449,(A2)+
;	ADDQ.W	#1,ADD
	BRA	FIN_AFF
	MOVE.W	#$32FC,(A2)+
	MOVE.W	(A0),(A2)+
	MOVE.W	#$22CC,(A2)+
	MOVE.W	#$5449,(A2)+
;	ADDQ.W	#1,ADD
	BRA	FIN_AFF


MOV23	MOVE.W	#$32CC,(A2)+
	TST.W	4(A0)
	BEQ	MOV2

	MOVEQ	#0,D0
	MOVE.W	2(A0),D0
	CMP.W	4(A0),D0
	BEQ	COMPARE5
	MOVE.W	#$22FC,(A2)+
	MOVE.L	2(A0),(A2)+
APRES5COMP	MOVE.W	#$5449,(A2)+
;	ADDQ.W	#1,ADD
	BRA	FIN_AFF

COMPARE5	CLR.W	ADD1
	SWAP	D0
	MOVE.W	4(A0),D0
	MOVE.W	#$22C0,D4
	MOVE.W	#7,D3
CHERCHCOMP5	CMP.L	(A3),D0
	BEQ.S	TROUVêC5
	ADDQ.W	#4,ADD1
	ADDQ.L	#4,A3
	ADDI.W	#1,D4
	DBRA	D3,CHERCHCOMP5
	LEA	-32(A3),A3
	MOVE.W	#$22FC,(A2)+
	MOVE.L	2(A0),(A2)+
	BRA	APRES5COMP
TROUVêC5	SUBA.W	ADD1,A3
	MOVE.W	D4,(A2)+
	BRA	APRES5COMP

MOV2	MOVEQ	#0,D0
	MOVE.W	2(A0),D0
	CLR.W	ADD1
	MOVE.W	#$32C0,D4
	MOVE.W	#7,D3
CHERCHMV2	CMP.L	(A3),D0
	BEQ.S	TROUVêMV2
	ADDQ.L	#4,A3
	ADDQ.W	#4,ADD1
	ADDQ.W	#1,D4
	DBRA	D3,CHERCHMV2
	LEA	-32(A3),A3
	MOVE.W	#$32FC,(A2)+
	MOVE.W	2(A0),(A2)+
	MOVE.W	#$32CC,(A2)+
	MOVE.W	#$5449,(A2)+
;	ADDQ.W	#1,ADD
	BRA	FIN_AFF
TROUVêMV2	SUBA.W	ADD1,A3
	MOVE.W	D4,(A2)+
	MOVE.W	#$32CC,(A2)+
	MOVE.W	#$5449,(A2)+
;	ADDQ.W	#1,ADD
	BRA	FIN_AFF


MOV12	MOVEQ	#0,D0
	MOVE.W	(A0),D0
	CMP.W	2(A0),D0
	BEQ	COMPARE4
	MOVE.W	(A0),D0
	CLR.W	ADD1
	MOVE.W	#$32C0,D4
	MOVE.W	#7,D3
CHERCHMVD	CMP.L	(A3),D0
	BEQ.S	TROUVêMVD
	ADDQ.L	#4,A3
	ADDQ.W	#4,ADD1
	ADDQ.W	#1,D4
	DBRA	D3,CHERCHMVD
	LEA	-32(A3),A3
	MOVE.W	#$22FC,(A2)+
	MOVE.L	(A0),(A2)+
	MOVE.W	#$32CC,(A2)+
	MOVE.W	#$5449,(A2)+
;	ADDQ.W	#1,ADD
	BRA	FIN_AFF
TROUVêMVD	SUBA.W	ADD1,A3
	MOVE.W	D4,(A2)+
	MOVE.W	#$32FC,(A2)+
	MOVE.W	2(A0),(A2)+
	MOVE.W	#$32CC,(A2)+
	MOVE.W	#$5449,(A2)+
;	ADDQ.W	#1,ADD
	BRA	FIN_AFF
	
APRES4COMP	MOVE.W	#$32CC,(A2)+
	MOVE.W	#$5449,(A2)+
;	ADDQ.W	#1,ADD
	BRA	FIN_AFF

COMPARE4	CLR.W	ADD1
	MOVE.W	#$32C0,D4
	MOVE.W	#7,D3
CHERCHCOMP4	CMP.L	(A3),D0
	BEQ.S	TROUVêC4
	ADDQ.W	#4,ADD1
	ADDQ.L	#4,A3
	ADDI.W	#1,D4
	DBRA	D3,CHERCHCOMP4
	LEA	-32(A3),A3
	MOVE.W	#$22FC,(A2)+
	MOVE.L	(A0),(A2)+
	BRA	APRES4COMP
TROUVêC4	SUBA.W	ADD1,A3
	MOVE.W	D4,(A2)+
	MOVE.W	D4,(A2)+
	BRA	APRES4COMP

NO_AFF	MOVE.W	#$5049,(A2)+	
	BSR	OPTI_ADDQ_ORS
;	ADDQ.W	#1,ADD
FIN_AFF	ADDQ.L	#8,A0
	ADDQ.L	#2,A1
	RTS

PREDECALET	LEA	BUF_DEC,A1
	LEA	PREDEC_TAB,A6
CHANGEY6	MOVE.W	#81-1,D6
CHANGE11
RECOP2	MOVE.W	#6-2,D7
RECOP11	MOVE.L	(A0)+,(A1)+
	MOVE.L	(A0)+,(A1)+
	DBRA	D7,RECOP11
	CLR.L	(A1)+
	CLR.L	(A1)+
CHANGE12	LEA	160-((6-1)*8)(A0),A0
	DBRA	D6,RECOP2

	LEA	BUF_DEC,A0
	MOVE.L	A0,(A6)+
	MOVE.W	#6,D3
CHANGE13
CHANGEY7
DECPGEN	LEA	6*8*81(A0),A1
	MOVE.L	A1,(A6)+
CHANGEY8
CHANGE14	MOVE.W	#(6*81)-1,D7
RECOP3	MOVE.L	(A0)+,(A1)+
	MOVE.L	(A0)+,(A1)+
	DBRA	D7,RECOP3

	MOVE.W	#1,D4
CHANGEY9
DECPG1	MOVE.W	#81-1,D5
DECP3	MOVE.W	#3,D6
CHANGE15
DECP2	MOVE.W	#6-1,D7
DECP1	ROXR	(A0)
	ADDQ.L	#8,A0
	DBRA	D7,DECP1
CHANGE16	LEA	-((6*8)-2)(A0),A0
	DBRA	D6,DECP2
CHANGE17	LEA	(6-1)*8(A0),A0
	DBRA	D5,DECP3
CHANGEY10
CHANGE18	LEA	-(6*8*81)(A0),A0
	DBRA	D4,DECPG1
	DBRA	D3,DECPGEN
	RTS

MAK_EFF	TST.W	FLAG_EFF
	BEQ	FLAGEFF_OFF
	MOVE.L	SCREEN2,A0	;MSK
	MOVE.L	SCREEN1,A1	;SPR
CHANGEY11	MOVE.W	#81-1,D6
CHANGE19
RECOMEF2	MOVE.W	#6-1,D7
RECOMEF1	CMPI.W	#-1,(A0)
	BEQ	QQQ
	TST.L	(A1)
	BEQ	EFF3
	TST.L	2(A1)
	BEQ	EFF1
	TST.W	(A1)
	BEQ	EFF23
	TST.W	2(A1)
	BEQ	EFF13
	TST.W	4(A1)
	BEQ	EFF12
EFF_ALL	MOVE.W	#$20C0,(A2)+	;6 NOPS
	MOVE.W	#$30C0,(A2)+
	MOVE.W	#$5448,(A2)+
	BRA.S	NO_EFF
QQQ	MOVE.W	#$5048,(A2)+
	BSR	OPTI_ADDQ_EFF
NO_EFF	ADDQ.L	#8,A1
	ADDQ.L	#2,A0
	DBRA	D7,RECOMEF1
	MOVE.W	#$41E8,(A2)+
CHANGE20	MOVE.W	#160-(6*8),(A2)+
	BSR	OPTI_ADDQ_EFF
	DBRA	D6,RECOMEF2
	MOVE.W	#$4E75,(A2)+
FLAGEFF_OFF	RTS

EFF3	MOVE.W	#$5848,(A2)+
	BSR	OPTI_ADDQ_EFF
	MOVE.W	#$30C0,(A2)+	;4 NOPS
	MOVE.W	#$5448,(A2)+
	BRA	NO_EFF

EFF1	MOVE.W	#$30C0,(A2)+	;3 NOPS
	MOVE.W	#$5C48,(A2)+
	BRA	NO_EFF

EFF23	TST.W	4(A1)
	BEQ	EFF2
	MOVE.W	#$5448,(A2)+	;5 NOPS
	BSR	OPTI_ADDQ_EFF
	MOVE.W	#$20C0,(A2)+
	MOVE.W	#$5448,(A2)+
	BRA	NO_EFF
EFF2	MOVE.W	#$5448,(A2)+	;4 NOPS
	BSR	OPTI_ADDQ_EFF
	MOVE.W	#$30C0,(A2)+
	MOVE.W	#$5848,(A2)+
	BRA	NO_EFF

EFF13	MOVE.W	#$30C0,(A2)+	;6 NOPS
	MOVE.W	#$5448,(A2)+
	MOVE.W	#$30C0,(A2)+
	MOVE.W	#$5448,(A2)+
	BRA	NO_EFF

EFF12	MOVE.W	#$20C0,(A2)+	;4 NOPS
	MOVE.W	#$5848,(A2)+
	BRA	NO_EFF

OPTI_ADDQ_EFF
	MOVE.W	#$5448,D0
	MOVE.W	#$5848,D1
	MOVE.W	#$5C48,D2
	MOVE.W	#$5048,D3
	MOVE.W	#$41E8,D4
	CLR.W	ADD1
CONT_OPTEF	CMP.W	-2(A2),D0
	BNE.S	ADEF2
	ADDQ.W	#2,ADD1
	SUBQ.L	#2,A2
	BRA	CONT_OPTEF
ADEF2	CMP.W	-2(A2),D1
	BNE.S	ADEF3
	ADDQ.W	#4,ADD1
	SUBQ.L	#2,A2
	BRA	CONT_OPTEF
ADEF3	CMP.W	-2(A2),D2
	BNE.S	ADEF4
	ADDQ.W	#6,ADD1
	SUBQ.L	#2,A2
	BRA	CONT_OPTEF
ADEF4	CMP.W	-2(A2),D3
	BNE.S	ADEF5
	ADDQ.W	#8,ADD1
	SUBQ.L	#2,A2
	BRA	CONT_OPTEF
ADEF5	CMP.W	-4(A2),D4
	BNE.S	FIN_OPTEF
	MOVE.W	-2(A2),D0
	ADD.W	D0,ADD1
	MOVE.W	#$5448,D0
	SUBQ.L	#4,A2
	BRA	CONT_OPTEF
FIN_OPTEF	TST.W	ADD1
	BEQ	FINI_OPTEF
	CMPI.W	#8,ADD1
	BGT	MAK_LEAEF
	CMPI.W	#2,ADD1
	BNE.S	TESTEF2
	MOVE.W	#$5448,(A2)+
	BRA	FINI_OPTEF
TESTEF2	CMPI.W	#4,ADD1
	BNE.S	TESTEF3
	MOVE.W	#$5848,(A2)+
	BRA	FINI_OPTEF
TESTEF3	CMPI.W	#6,ADD1
	BNE.S	TESTEF4
	MOVE.W	#$5C48,(A2)+
	BRA	FINI_OPTEF
TESTEF4	MOVE.W	#$5048,(A2)+
	BRA	FINI_OPTEF
MAK_LEAEF	MOVE.W	#$41E8,(A2)+
	MOVE.W	ADD1,(A2)+
FINI_OPTEF	RTS

PREP_ECR	MOVE.L	#BUFFER,D0
	CLR.B	D0
	MOVE.L	D0,SCREEN1
	ADDI.L	#32000,D0
	MOVE.L	D0,SCREEN2
	MOVE.B	SCREEN1+1,$FFFF8201.W
	MOVE.B	SCREEN1+2,$FFFF8203.W
	MOVE.L	SCREEN1,A0
	MOVE.L	SCREEN2,A1
	MOVE	#7999,D0
NETTOIE	CLR.L	(A0)+
	CLR.L	(A1)+
	DBF	D0,NETTOIE
	RTS

trigo	movem.l d0-d7/a4-a6,-(a7)

	lea cos_tab,a4	;a4 pointe table cos
	lea sin_tab,a5	;a5 pointe table sin

	lea x_angle,a6
	move.w (a6)+,d2	;d2=x_angle
	move.w (a6)+,d1	;d1=y_angle
	move.w (a6)+,d0	;d0=z_angle
	
	move.w 0(a5,d2.w),d5	;d5=sin_x
	move.w 0(a4,d2.w),d4	;d4=cos_x
	move.w 0(a5,d1.w),d3	;d3=sin_y
	move.w 0(a4,d1.w),d2	;d2=cos_y
	move.w 0(a5,d0.w),d1	;d1=sin_z
	move.w 0(a4,d0.w),d0	;d0=cos_z

	lea var_3d,a6	;a6 pointe la zone
			;qui contiendra les
			;calculs 
			;intermediaires

	moveq #9,d7		;d7 contient le nombre 
			;de decalages a faire	
			;pour diviser par 512
			
	;****** calcul de C *****
	
sp_c	move.w d3,d6	;sin_y*512
	neg.w d6		;inverse signe
	move.w d6,(a6)+	;-sin_y*512
	
	;****** calcul de F *****
	
sp_f	move.w d2,d6	;cos_y*512 
	muls d5,d6		;cos_y*512*sin_x*512
	asr.l d7,d6		;divise par 512
	move.w d6,(a6)+	;cos_y*sin_x*512
	
	;****** calcul de I *****
	
sp_i	move.w d2,d6	;cos_y*512
	muls d4,d6		;cos_y*512*cos_x*512
	asr.l d7,d6		;divise par 512
	move.w d6,(a6)+	;cos_y*cos_x*512

	;****** calcul de A *****	

sp_a	move.w d0,d6	;cos_z*512
	muls d2,d6		;cos_z*512*cos_y*512
	asr.l d7,d6		;divise par 512
	move.w d6,(a6)+	;cos_z*cos_y*512

	;****** calcul de D *****

sp_d	move.w d1,d6	;sin_z*512
	muls d4,d6		;sin_z*512*cos_x*512
	asr.l d7,d6		;divise par 512
	movea.w d6,a4	;stocke resultat
			;dans a4

	move.w d0,d6	;cos_z*512
	muls d3,d6		;cos_z*512*sin_y*512
	asr.l d7,d6		;divise par 512
	muls d5,d6		;cos_z*sin_y*512
			;     *sin_x*512
	asr.l d7,d6		;divise par 512
	sub.w a4,d6		;soustrait resultat
			;stockÇ dans a4
	move.w d6,(a6)+	

	;****** calcul de G *****

sp_g	move.w d1,d6	;sin_z*512
	muls d5,d6		;sin_z*512*sin_x*512
	asr.l d7,d6		;divise par 512
	movea.w d6,a4	;stocke dans a4

	move.w d0,d6	;cos_z*512
	muls d3,d6		;cos_z*512*sin_y*512
	asr.l d7,d6		;divise par 512
	muls d4,d6		;cos_z*sin_y*512
			;     *cos_x*512
	asr.l d7,d6		;divise par 512
	add.w a4,d6		;ajoute resultat
			;stockÇ dans a4
	move.w d6,(a6)+	

	;****** calcul de B *****
	
sp_b	move.w d1,d6	;sin_z*512
	muls d2,d6		;sin_z*512*cos_y*512
	asr.l d7,d6		;divise par 512
	move.w d6,(a6)+	;sin_z*cos_y*512

	;****** calcul de E *****
	
sp_e	move.w d0,d6	;cos_z*512
	muls d4,d6		;cos_z*512*cos_x*512
	asr.l d7,d6		;divise par 512
	movea.w d6,a4	;stocke dans a4
	
	move.w d1,d6	;sin_z*512
	muls d3,d6		;sin_z*512*sin_y*512
	asr.l d7,d6		;divise par 512
	muls d5,d6		;sin_z*sin_y*512
			;     *sin_x*512
	asr.l d7,d6		;divise par 512
	add.w a4,d6		;ajoute resultat
			;stockÇ dans a4
	move.w d6,(a6)+	
	
	;****** calcul de H *****

sp_h	move.w d0,d6	;cos_z*512
	muls d5,d6		;cos_z*512*sin_x*512
	asr.l d7,d6		;divise par 512
	movea.w d6,a4	;stocke dans a4
	
	move.w d1,d6	;sin_z*512
	muls d3,d6		;sin_z*512*sin_y*512
	asr.l d7,d6		;divise par 512
	muls d4,d6		;sin_z*sin_y*512
			;     *cos_x*512
	asr.l d7,d6		;divise par 512
	sub.w a4,d6		;soustrait resultat
			;stockÇ dans a4
	move.w d6,(a6)+	
	
	movem.l (a7)+,d0-d7/a4-a6
	rts

;********************************************
; calcul des coordonnees planes             *
; en entree: xe,ye,ze                       *
;            x_angle,y_angle,z_angle        *
;            z_pt_fuite z du point de fuite *
; en sortie: xp,yp coordonnÇes planes       *
;            new_xe,new_ye,new_ze nouvelles *
;            coordonnÇes spatiales          *
;********************************************

sp_to_pl movem.l d0-d7/a1-a6,-(a7)
	
	lea points,a6		;a6 pointe coords
	ADDA.L	POINTEUR,A6
	move.w (a6)+,d0	;d0=xe
	move.w (a6)+,d1	;d1=ye
	move.w (a6)+,d2	;d2=ze
;	ADD	#-100,D2
	ADD.L	#6,POINTEUR
	
	lea depla,a3
	move.w (a3)+,d3	;xdep
	move.w (a3)+,d4	;ydep
	move.w (a3)+,d5	;zdep
	ext.l d3
	ext.l d4
	ext.l d5
	moveq #9,d6
	asl.l d6,d3 	;xdep*512
	asl.l d6,d4		;ydep*512
	asl.l d6,d5		;zdep*512
	movea.l d3,a1	
	movea.l d4,a2
	movea.l d5,a3
	
	lea var_3d,a6	;pointe zone de
			;calcul 
			;intermediaire

	move.w d0,d3	;d3=xe
	move.w d1,d4	;d4=ye
	move.w d2,d5	;d5=ze

	muls (a6)+,d3	;d3=c*xe*512
	muls (a6)+,d4	;d4=f*ye*512
	muls (a6)+,d5	;d5=i*ze*512
	add.l d4,d5		; + f*ye*512
	add.l d3,d5		; + c*xe*512
	add.l a3,d5		; + zdep*512
	move.l d5,a5	;a5=new_ze*512
	divs z_pt_fuite,d5	;d5=new_ze/z_pt_fuite

	move.w #512,d7
	sub.w d5,d7		;d7=512*q
			;d7=512*
			;(1-new_ze/z_pt_fuite)
	
	move.w d0,d3	;d3=xe
	move.w d1,d4	;d4=ye	
	move.w d2,d5	;d5=ze
		
	muls (a6)+,d3	;d3=a*xe*512
	muls (a6)+,d4	;d4=d*ye*512
	muls (a6)+,d5	;d5=g*ze*512
	add.l d4,d5		;+ a*xe*512
	add.l d3,d5		;+ d*xe*512
	add.l a1,d5		;+ xdep*512
	move.l d5,a4	;a4=new_xe*512
	divs d7,d5		;d5.w=
			;(new_xe*512)/(q*512)
			;d5=new_xe/q
	
	muls (a6)+,d0	;d0=b*xe*512
	muls (a6)+,d1	;d1=e*ye*512
	muls (a6)+,d2	;d2=h*ze*512
	add.l d0,d1		; + b*xe*512
	add.l d1,d2		; + e*ye*512
	add.l a2,d2		; + ydep*512
	move.l d2,d6	;d6=new_ye*512
	divs d7,d2		;d2.w=new_ye/q
	
	lea xp,a6		;a6 pointe zone
			;sauvergarde coords
			;plane qu'on
			;centre Ö l'Çcran

	add.w #160,d5	;d5=xp+160
	move.w d5,(a6)+	;xp
	
	add.w #100,d2	;d2=yp+100
	move.w d2,(a6)+	;yp

	move.l a4,d5	;new_xe*512
	move.l a5,d7	;new_ze*512
	moveq #9,d0
	asr.l d0,d5		;new_xe
	asr.l d0,d6		;new_ye
	asr.l d0,d7		;new_ze
			
			;sauve nouvelles 
			;coords spatiales
	move.w d5,(a6)+	;new_xe
	move.w d6,(a6)+	;new_ye
	move.w d7,(a6)+	;new_ze
	MOVE	D7,ZA	
	movem.l (a7)+,d0-d7/a1-a6
	rts

ROUTINE
;	LEA	DATA_Y,A2
;	LEA	DATA_X,A1
	CLR.L	D0
	CLR.L	D1
	CLR.L	D2
	MOVE	xp,D0
	MOVE	yp,d1
	MULU	#160,D1
	DIVS	#16,D0
	MOVE	D0,D2
	MULU	#8,D2
	ADD.L	D2,D1
	SWAP	D0
	CMPI	#$7,D0
	BGT.S	PLUS_UN
	BRA.S	PLUS_LOIN
PLUS_UN	ADD.L	#1,D1
	SUB.L	#8,D0
PLUS_LOIN
	LEA	KK,A0
	MULU	#8,D0
	JSR	0(A0,D0.W)

	CMPI	#110,ZA
	BGT.S	PLD
	BRA.S	NOPLD
PLD	ADD	#2,D1
NOPLD	MOVE	D1,(A2)+
	RTS


KK	MOVE.B	#%10000000,(A1)+
	NOP
	RTS
	MOVE.B	#%01000000,(A1)+
	NOP
	RTS
	MOVE.B	#%00100000,(A1)+
	NOP
	RTS	
	MOVE.B	#%00010000,(A1)+
	NOP
	RTS	
	MOVE.B	#%00001000,(A1)+
	NOP
	RTS	
	MOVE.B	#%00000100,(A1)+
	NOP
	RTS
	MOVE.B	#%00000010,(A1)+
	NOP
	RTS
	MOVE.B	#%00000001,(A1)+
	NOP
	RTS
	
PRP_CRB	LEA	COURB_SCROL,A0
	LEA	BUF_CRB_SCROL,A1
	MOVE.W	#NB_POINTS-1,D7
PRECOP	MOVE.L	(A0)+,(A1)+
	DBRA	D7,PRECOP
	MOVEQ	#63,D7
PRECEFF	CLR.L	(A1)+
	DBRA	D7,PRECEFF
	LEA	BUF_CRB_SCROL,A0
	LEA	1024*4(A0),A1
	MOVEQ	#6,D6
RECOMDECC	MOVE.W	#NB_POINTS-1,D7
DECAL_CRB	MOVE.W	(A0)+,D0
	MOVE.W	(A0)+,D1
	ADDQ.W	#2,D0
	CMPI.W	#16,D0
	BNE.S	SUITPRP
	MOVEQ	#0,D0
	ADDQ.W	#8,D1
SUITPRP	CMPI.W	#17,D0
	BNE.S	SUITPRP2
	MOVEQ	#1,D0
	ADDQ.W	#8,D1
SUITPRP2	MOVE.W	D0,(A1)+
	MOVE.W	D1,(A1)+
	DBRA	D7,DECAL_CRB
	MOVEQ	#63,D7
CONTEFFC	CLR.L	(A1)+
	DBRA	D7,CONTEFFC	
	LEA	256(A0),A0
	DBRA	D6,RECOMDECC

SUIIIIT	LEA	BUF_CRB_SCROL,A0
	LEA	PNTS,A1
	MOVE.W	#(1024*8)-1,D7
RECOMCRB	MOVE.W	(A0),D0
	ADD.W	D0,D0
	MOVE.W	(A1,D0.W),D0
	MOVE.W	D0,(A0)
	ADDQ.L	#4,A0
	DBRA	D7,RECOMCRB
	RTS

PRP_FNT	LEA	FNT8X8,A0
	LEA	BUF_COD_SCROL,A1
	LEA	TABL_ADR_SCROL,A6
	MOVEQ	#58,D6	;NOMBRE DE LETTRES
NB_LET	MOVEQ	#7,D3	;NOMBRE DE COLONNES-1
COLONNE2	MOVEQ	#0,D4
	MOVEQ	#0,D2
	MOVEQ	#7,D7	;NOMBRE DE LIGNES-1
	MOVE.L	A1,(A6)+
COLONNE	MOVEQ	#0,D0
	MOVE.B	(A0)+,D0
	BTST	D3,D0
	BNE.S	AFFICH
	CMPI.W	#2,D2
	BGE	OPT_MOVEM
CONT_MOVEM	MOVEQ	#0,D2
	ADDQ.W	#1,D4
	MOVE.W	#$5848,(A1)+
CONTINUE	DBRA	D7,COLONNE
	LEA	-8(A0),A0
	CMPI.W	#2,D4
	BGE.S	OPTIMIZE2
CONTINUE3	DBRA	D3,COLONNE2
	CMPI.W	#2,D2
	BGE	OPT_MOVEM
	MOVE.W	#$4E75,(A1)+
	LEA	8(A0),A0
	DBRA	D6,NB_LET
	RTS

AFFICH	CMPI.W	#2,D4
	BGE.S	OPTIMIZE
CONTINUE2	MOVEQ	#0,D4
	MOVE.L	#$30183218,(A1)+
	MOVE.L	#$81711000,(A1)+
	ADDQ.W	#1,D2
	BRA.S	CONTINUE

OPTIMIZE	MOVE.W	D4,D5
	CMPI.W	#2,D4
	BEQ.S	MAK_ADDQ
	ADD.W	D4,D4
	SUBA.W	D4,A1
	ADD.W	D4,D4
	MOVE.W	#$41E8,(A1)+
	MOVE.W	D4,(A1)+
	BRA.S	CONTINUE2
MAK_ADDQ	SUBQ.W	#4,A1
	MOVE.W	#$5048,(A1)+
	BRA.S	CONTINUE2

OPTIMIZE2	MOVE.W	D4,D5
	CMPI.W	#2,D4
	BEQ.S	MAK_ADDQ2
	ADD.W	D4,D4
	SUBA.W	D4,A1
	ADD.W	D4,D4
	MOVE.W	#$41E8,(A1)+
	MOVE.W	D4,(A1)+
	BRA.S	CONTINUE3
MAK_ADDQ2	SUBQ.W	#4,A1
	MOVE.W	#$5048,(A1)+
	BRA.S	CONTINUE3

OPT_MOVEM	MOVE.W	D2,D5
	LSL	#3,D2
	SUBA.W	D2,A1
CONT_OPT	TST.W	D5
	BEQ	CONT_MOVEM
	CMPI.W	#1,D5
	BEQ.S	MOV_NORM
	CMPI.W	#2,D5
	BEQ.S	MOVEM2
	CMPI.W	#3,D5
	BEQ.S	MOVEM3
	CMPI.W	#4,D5
	BEQ.S	MOVEM4
	MOVE.L	#$4C9800FF,(A1)+
	MOVE.L	#$81711000,(A1)+
	MOVE.L	#$85713000,(A1)+
	MOVE.L	#$89715000,(A1)+
	MOVE.L	#$8D717000,(A1)+
	SUBQ.W	#4,D5
	BRA.S	CONT_OPT

MOV_NORM	MOVE.L	#$30183218,(A1)+
	MOVE.L	#$81711000,(A1)+
	BRA	CONT_MOVEM

MOVEM2	MOVE.L	#$4C98000F,(A1)+
	MOVE.L	#$81711000,(A1)+
	MOVE.L	#$85713000,(A1)+
	BRA	CONT_MOVEM

MOVEM3	MOVE.L	#$4C98003F,(A1)+
	MOVE.L	#$81711000,(A1)+
	MOVE.L	#$85713000,(A1)+
	MOVE.L	#$89715000,(A1)+
	BRA	CONT_MOVEM

MOVEM4	MOVE.L	#$4C9800FF,(A1)+
	MOVE.L	#$81711000,(A1)+
	MOVE.L	#$85713000,(A1)+
	MOVE.L	#$89715000,(A1)+
	MOVE.L	#$8D717000,(A1)+
	BRA	CONT_MOVEM

PRP_TXT	LEA	TEXT,A0
	LEA	BUF_TEXT,A1
CONTXT	MOVEQ	#0,D0
	MOVE.B	(A0)+,D0
	BMI.S	FIN_TXT
	SUBI.B	#32,D0
	LSL	#5,D0
	LEA	TABL_ADR_SCROL,A2
	ADDA.W	D0,A2
	MOVE.L	A2,(A1)+
	BRA.S	CONTXT
FIN_TXT	MOVE.L	#-1,(A1)
	RTS

	
; a0: Pointer on packed Data
; a1: Pointer on destination of unpacked data
decrunch:	movem.l d0-a6,-(sp)
		cmpi.l	#'Ice!',(a0)+	; Is data packed?
		bne.s	ice_03		; no!
		move.l	(a0)+,d0	; read packed data
		lea	-8(a0,d0.l),a5
		move.l	(a0)+,(sp)
		movea.l a1,a4
		movea.l a1,a6
		adda.l	(sp),a6
		movea.l a6,a3
		bsr.s	ice_08
		bsr.s	ice_04
		bsr	ice_0c		;; Picture decrunch!
		bcc.s	ice_03		;; These marked lines may be
		move.w	#$0f9f,d7	;; removed in your own sources
ice_00:		moveq	#3,d6		;; if you do not use the
ice_01:		move.w	-(a3),d4	;; additional algorithm.
		moveq	#3,d5		;;
ice_02:		add.w	d4,d4		;;
		addx.w	d0,d0		;;
		add.w	d4,d4		;;
		addx.w	d1,d1		;;
		add.w	d4,d4		;;
		addx.w	d2,d2		;;
		add.w	d4,d4		;;
		addx.w	d3,d3		;;
		dbra	d5,ice_02	;;
		dbra	d6,ice_01	;;
		movem.w d0-d3,(a3)	;;
		dbra	d7,ice_00	;;
ice_03:		movem.l (sp)+,d0-a6
		rts
ice_04:		bsr.s	ice_0c
		bcc.s	ice_07
		moveq	#0,d1
		bsr.s	ice_0c
		bcc.s	ice_06
		lea	ice_1a(pc),a1
		moveq	#4,d3
ice_05:		move.l	-(a1),d0
		bsr.s	ice_0f
		swap	d0
		cmp.w	d0,d1
		dbne	d3,ice_05
		add.l	20(a1),d1
ice_06:		move.b	-(a5),-(a6)
		dbra	d1,ice_06
ice_07:		cmpa.l	a4,a6
		bgt.s	ice_12
		rts
ice_08:		moveq	#3,d0
ice_09:		move.b	-(a5),d7
		ror.l	#8,d7
		dbra	d0,ice_09
		rts
ice_0a:		move.w	a5,d7
		btst	#0,d7
		bne.s	ice_0b
		move.l	-(a5),d7
		addx.l	d7,d7
		bra.s	ice_11
ice_0b:		move.l	-5(a5),d7
		lsl.l	#8,d7
		move.b	-(a5),d7
		subq.l	#3,a5
		add.l	d7,d7
		bset	#0,d7
		bra.s	ice_11
ice_0c:		add.l	d7,d7
		beq.s	ice_0d
		rts
ice_0d:		move.w	a5,d7
		btst	#0,d7
		bne.s	ice_0e
		move.l	-(a5),d7
		addx.l	d7,d7
		rts
ice_0e:		move.l	-5(a5),d7
		lsl.l	#8,d7
		move.b	-(a5),d7
		subq.l	#3,a5
		add.l	d7,d7
		bset	#0,d7
		rts
ice_0f:		moveq	#0,d1
ice_10:		add.l	d7,d7
		beq.s	ice_0a
ice_11:		addx.w	d1,d1
		dbra	d0,ice_10
		rts
ice_12:		lea	ice_1b(pc),a1
		moveq	#3,d2
ice_13:		bsr.s	ice_0c
		dbcc	d2,ice_13
		moveq	#0,d4
		moveq	#0,d1
		move.b	1(a1,d2.w),d0
		ext.w	d0
		bmi.s	ice_14
		bsr.s	ice_0f
ice_14:		move.b	6(a1,d2.w),d4
		add.w	d1,d4
		beq.s	ice_16
		lea	ice_1c(pc),a1
		moveq	#1,d2
ice_15:		bsr.s	ice_0c
		dbcc	d2,ice_15
		moveq	#0,d1
		move.b	1(a1,d2.w),d0
		ext.w	d0
		bsr.s	ice_0f
		add.w	d2,d2
		add.w	6(a1,d2.w),d1
		bra.s	ice_18
ice_16:		moveq	#0,d1
		moveq	#5,d0
		moveq	#0,d2
		bsr.s	ice_0c
		bcc.s	ice_17
		moveq	#8,d0
		moveq	#$40,d2
ice_17:		bsr.s	ice_0f
		add.w	d2,d1
ice_18:		lea	2(a6,d4.w),a1
		adda.w	d1,a1
		move.b	-(a1),-(a6)
ice_19:		move.b	-(a1),-(a6)
		dbra	d4,ice_19
		bra	ice_04
		DC.B $7f,$ff,$00,$0e,$00,$ff,$00,$07
		DC.B $00,$07,$00,$02,$00,$03,$00,$01
		DC.B $00,$03,$00,$01
ice_1a:		DC.B $00,$00,$01,$0d,$00,$00,$00,$0e
		DC.B $00,$00,$00,$07,$00,$00,$00,$04
		DC.B $00,$00,$00,$01
ice_1b:		DC.B $09,$01,$00,$ff,$ff,$08,$04,$02
		DC.B $01,$00
ice_1c:		DC.B $0b,$04,$07,$00,$01,$20,$00,$00
		DC.B $00,$20
	
	SECTION	DATA
ZIK	INCBIN	MUSIX.MUS
PIC	INCBIN	zappy80_.PI1
PIC2	INCBIN	ZERIOUL_.PI1
PIC3	INCBIN	DAN2_.PI1
PIC4	INCBIN	BLYZ_.PI1
FIC_OPT	INCBIN	zappy1.OPT
FIC_OPT2	INCBIN	ZERIOUL2.OPT
FIC_OPT3	INCBIN	DAN.OPT
FIC_OPT4	INCBIN	BLYZ.OPT

	DS.L	100
COURB	INCBIN	BIGGIE4.CRB
FIN_CRB	DS.L	200
	DC.W	-1

TABLE_SPR	DC.L	DECRUNCHED+34		Z
	DC.L	DECRUNCHED+34+40	A
	DC.L	DECRUNCHED+34+80	P
;	DC.L	DECRUNCHED+34+120	Y
TABLE_SPR_ZERIOUL
	DC.L	DECRUNCHED2+34+32	Z
	DC.L	DECRUNCHED2+34+64	E
	DC.L	DECRUNCHED2+34+96	R
	DC.L	DECRUNCHED2+34+128	I
	DC.L	DECRUNCHED2+34+(160*63)	O
	DC.L	DECRUNCHED2+34+(160*63)+32	U


TABLE_SPR_DANATO
	DC.L	DECRUNCHED2+34		D
	DC.L	DECRUNCHED2+34+32	A
	DC.L	DECRUNCHED2+34+64	N
	DC.L	DECRUNCHED2+34+96	T

TABLE_SPR_BLYZ
	DC.L	DECRUNCHED+34
	DC.L	DECRUNCHED+34+24
	DC.L	DECRUNCHED+34+48
	DC.L	DECRUNCHED+34+24*3
	DC.L	DECRUNCHED+34+24*4
	DC.L	DECRUNCHED+34+24*5

cos_tab	incbin 'COSIN.DAT'	;tables sinus cosinus
sin_tab	equ cos_tab+720

points	
 DC  -5,45,45,5,45,45
 DC  -15,45,45,15,45,45
 DC  -25,45,45,25,45,45
 DC  -35,45,45,35,45,45
 DC  -45,45,45,45,45,45

 DC  -5,-45,45,5,-45,45
 DC  -15,-45,45,15,-45,45
 DC  -25,-45,45,25,-45,45
 DC  -35,-45,45,35,-45,45
 DC  -45,-45,45,45,-45,45

 DC  45,-5,45,45,5,45
 DC  45,-15,45,45,15,45
 DC  45,-25,45,45,25,45
 DC  45,-35,45,45,35,45

 DC  -45,-5,45,-45,5,45
 DC  -45,-15,45,-45,15,45
 DC  -45,-25,45,-45,25,45
 DC  -45,-35,45,-45,35,45


 DC  -5,45,-45,5,45,-45
 DC  -15,45,-45,15,45,-45
 DC  -25,45,-45,25,45,-45
 DC  -35,45,-45,35,45,-45
 DC  -45,45,-45,45,45,-45

 DC  -5,-45,-45,5,-45,-45
 DC  -15,-45,-45,15,-45,-45
 DC  -25,-45,-45,25,-45,-45
 DC  -35,-45,-45,35,-45,-45
 DC  -45,-45,-45,45,-45,-45

 DC  45,-5,-45,45,5,-45
 DC  45,-15,-45,45,15,-45
 DC  45,-25,-45,45,25,-45
 DC  45,-35,-45,45,35,-45

 DC  -45,-5,-45,-45,5,-45
 DC  -45,-15,-45,-45,15,-45
 DC  -45,-25,-45,-45,25,-45
 DC  -45,-35,-45,-45,35,-45




 DC  -45,-45,-5,-45,-45,5
 DC  -45,-45,-15,-45,-45,15
 DC  -45,-45,-25,-45,-45,25
 DC  -45,-45,-35,-45,-45,35

 DC  -45,45,-5,-45,45,5
 DC  -45,45,-15,-45,45,15
 DC  -45,45,-25,-45,45,25
 DC  -45,45,-35,-45,45,35

 DC  45,-45,-5,45,-45,5
 DC  45,-45,-15,45,-45,15
 DC  45,-45,-25,45,-45,25
 DC  45,-45,-35,45,-45,35

 DC  45,45,-5,45,45,5
 DC  45,45,-15,45,45,15
 DC  45,45,-25,45,45,25
 DC  45,45,-35,45,45,35


	
depla	dc	0,0,0

FNT8X8	
	DC.B	0,0,0,0,0,0,0,0
	DC.B 24,24,48,48,0,96,96,0
	DC.B	0,0,0,0,0,0,0,0
	DC.B	0,0,0,0,0,0,0,0
	DC.B	0,0,0,0,0,0,0,0
	DC.B	0,0,0,0,0,0,0,0
	DC.B	0,0,0,0,0,0,0,0
	DC.B 24,24,48,0,0,0,0,0
	DC.B 24,56,48,48,48,56,24,0
	DC.B 48,56,24,24,24,56,48,0
	DC.B 18,84,56,254,56,84,144,0
	DC.B	0,0,0,0,0,0,0,0
	DC.B 0,0,0,0,48,48,96,0
	DC.B 0,0,0,126,126,0,0,0
	DC.B 0,0,0,0,0,48,48,0
	DC.B 254,0,252,0,248,0,240,0
	DC.B 124,198,206,214,230,198,124,0
	DC.B 24,56,56,24,24,60,60,0
 DC.B 60,94,102,12,24,54,126,0
 DC.B 126,126,6,28,6,126,124,0
 DC.B 28,60,108,204,254,254,12,0
 DC.B 126,126,64,124,6,126,124,0
 DC.B 60,102,96,124,102,102,60,0
 DC.B 126,118,76,12,24,24,24,0
 DC.B 60,102,102,60,102,102,60,0
 DC.B 60,102,102,62,6,6,60,0
 DC.B 0,0,48,48,0,48,48,0
	DC.B	0,0,0,0,0,0,0,0
	DC.B	0,0,0,0,0,0,0,0
	DC.B	0,0,0,0,0,0,0,0
	DC.B	0,0,0,0,0,0,0,0
 DC.B 60,102,102,12,0,24,24,0
	DC.B	0,0,0,0,0,0,0,0

	DC.B	24,56,56,76,124,140,206,0	;A
	DC.B	236,102,102,108,102,102,236,0	;B
	DC.B	46,98,224,224,224,98,46,0	;C
	DC.B	236,102,102,102,102,102,236,0	;D
	DC.B	238,98,96,108,96,98,238,0	;E
	DC.B	238,96,96,104,96,96,224,0	;F
	DC.B	46,98,224,238,230,102,44,0	;G
	DC.B	230,102,102,110,102,102,230,0	;H
	DC.B	60,24,24,24,24,24,60,0	;I
	DC.B	30,12,12,12,12,76,104,0	;J
 	DC.B	230,100,104,124,110,102,230,0	;K
	DC.B	240,96,96,96,96,98,238,0	;L
	DC.B	198,110,190,150,134,134,206,0	;M
	DC.B	198,98,178,154,140,134,194,0	;N
	DC.B	108,198,198,198,198,198,108,0	;O
	DC.B	236,102,102,108,96,96,224,0	;P
	DC.B	108,198,198,198,198,198,106,0	;Q
	DC.B	236,102,102,108,104,100,230,0	;R
	DC.B	110,194,240,60,14,134,236,0	;S
	DC.B	126,90,24,24,24,24,60,0	;T
	DC.B	246,98,98,98,98,98,28,0	;U
	DC.B	230,98,100,52,52,24,24,0	;V
	DC.B	230,194,194,210,250,236,198,0	;W
	DC.B	198,98,52,60,88,140,198,0	;X
	DC.B	230,98,52,24,24,24,60,0	;Y
	DC.B	246,142,28,56,112,226,222,0	;Z

	DC.B	0,0,0,0,0,0,0,0
 DC.B 254,0,126,0,62,0,30,0
	EVEN
	
COURB_SCROL	INCBIN	TLB_CERC.CRB	
EFFAC	INCBIN	TLB_CERC.EFF

	DS.L	2
MOUVEMENT	INCBIN	MOVE_1.CRB
ENDED_CRB	DC.L	-1

COURT_TABL	DC.L	BUF_CRB_SCROL,BUF_CRB_SCROL+(1024*4),BUF_CRB_SCROL+(1024*8)
	DC.L	BUF_CRB_SCROL+(1024*12),BUF_CRB_SCROL+(1024*16)
	DC.L	BUF_CRB_SCROL+(1024*20),BUF_CRB_SCROL+(1024*24),BUF_CRB_SCROL+(1024*28)

TEXT	DCB.B	17,32
	DC.B	"HEY                 "
	DC.B	"IT IS NOW FOUR O CLOCK IN THE MORNING "
	DC.B	"AND I HAVE JUST FIND A NEW POSSIBILITY "
	DC.B	"FOR OPTIMISING MY FAMOUS DOTS SCROLLING "
	DC.B	"WELL KNOWN OF EVERYBODY ( HI MARLON !!! ) !!! "
	DC.B	" THAT IS THE END TIME BECAUSE I MUST CODE "
	DC.B	"MY NEW IDEA, NEXT MEETING IN ONE HOUR ..."
	DC.B	"......  BEEP-BEEP  ... YEAH !! IT IS QUATER PAST FOUR AND I HAVE DONE IT !!! "
	DC.B	"I FINALLY OPTIMIZE THIS F...ING SCROLL !!! "
	DC.B	"I EARNED MORE THAN TEN RASTER-LINES !!! "
	DC.B	"FANTASTIC . PLEASE WAIT I GO IN MONST 2 "
	DC.B	"TO VERIFY IF I FORGOT NOTHING AT ALL...."
	DCB.B	20,32
	DC.B	-1
	EVEN
	
COLORS_FOR_THE_CIRCLE
	DC	$300,$400,$500,$600,$700,$710,$720,$730,$740,$750,$760,$770
	DC	$771,$772,$773,$774,$775,$776,$777,$776,$775,$774,$773,$772,$771
	DC	$770,$760,$750,$740,$730,$720,$710,$700,$600,$500,$400
	DC.L	-1

PNTS
N	SET	32768
	REPT	16
	DC.W	N
N	SET	N/2
	ENDR

	SECTION	BSS
ANC_PAL	DS.L	8
ANC_VBL	DS.L	1
ANC_TIM	DS.L	1
SAUV_SP	DS.L	1
SAUVEC	DS.W	1
MFP	DS.B	8
	DS.B	256
BUFFER	DS.L	16000
	DS.B	256
SCREEN1	DS.L	1
SCREEN2	DS.L	1
NUMERO	DS.L	1
PREDEC_TAB	DS.L	8
BUF_DEC	DS.L	(12*81)*8
PNT_CRB	DS.L	1
VARI	DS.W	1
ADD1	DS.W	1
ANNEX	DS.L	1
FLAG_EFF	DS	1

xe	ds.w 1		;coordonnees spatiales
ye	ds.w 1
ze	ds.w 1

xdep	ds.w 1		;dÇplacements
ydep	ds.w 1
zdep	ds.w 1

xp	ds.w 1		;coordonnees planes
yp	ds.w 1

new_xe	ds.w 1		;nouvelles coords 
new_ye	ds.w 1		;apräs rotation
new_ze	ds.w 1

x_angle	ds.w 1		;angles de rotation
y_angle	ds.w 1
z_angle	ds.w 1	

z_pt_fuite	ds.w 1		;coordonnÇes z du 
			;du point de fuite

var_3d	ds.w 9                  ;tableau pour calculs
POINTEUR	DS.L	1
PNT_COLOR	DS.L	1
PNT_FAD	DS.L	1
PNT_FAD2	DS.L	1
DATA_X
;	DS.B	NB_POS*NB_PTS
DATA_Y
;	DS	NB_POS*NB_PTS

REG_3D	DS.L	16
CNT	DS.L	1
CNT2	DS.L	1
ZA	DS	1

TABLE_GEN	DS.B	600
DECRUNCHED2
DECRUNCHED	DS.B	128*160+66
BUF_COD	DS.B	195000	ZAPPY=193618
;			ZERIOUL=193770
;			DAN=133978

PNT_MOV	DS.L	1
PNT1	DS.W	1
PNT_TEXT	DS.L	1
TABL_ADR_SCROL	DS.L	8*59
BUF_TEXT	DS.L	2000
BUF_CRB_SCROL	DS.L	1024*8
BUF_COD_SCROL	DS.B	5928	;10 KO DE MOINS QUE LA DERNIERE VERSION

