	CLR.L	-(SP)
	MOVE	#$20,-(SP)
	TRAP	#1
	ADDQ	#6,SP


	move.w	#$2300,SR
;		move.w	#$2700,SR
		clr.b	$FFFFFA07.w
		clr.b	$FFFFFA09.w
		MOVE.L	#RT,$70.W
		MOVE.L	#RT,$68.W
		MOVE.L	#RT,$120.W

;	MOVE.L	#RT,$70.W
;	MOVE.L	#RT,$120.W
;	MOVE.L	#RT,$134.W
;	MOVE	#$2300,SR
;	CLR.B	$FFFFFA07.W
;	CLR.B	$FFFFFA09.W
	
	move.w	#$007,$ffff8240.w
	
	LEA	PRG,A0
	LEA	$600.W,A1
	MOVE	#(PRG_END-PRG)/4,D0
COPING	MOVE.L	(A0)+,(A1)+
	DBF	D0,COPING

	move.w	#$070,$ffff8240.w
	JSR	RELOC
	move.w	#$700,$ffff8240.w
	JMP	$600.W
;	JMP	PRG
RT	RTE
RELOC
	LEA	$600.W,A0
;	LEA		PRG,A0
	MOVE.L	A0,A1
	ADD.L	2(A0),A1
	ADD.L	6(A0),A1
	LEA	31(A1),A1
	MOVEQ	#0,D0
	
	LEA	$600.W,A0
;	LEA		PRG,A0
	LEA	28(A0),A0
	MOVE.L	A0,D1
	
RELOCATION	MOVE.B	(A1)+,D0
	BEQ.S	RELOC_END
	CMP.W	#1,D0
	BNE.S	RELOC1
	ADD.W	#254,A0
	BRA.S	RELOCATION
RELOC1	ADD.W	D0,A0
	ADD.L	D1,(A0)
	BRA.S	RELOCATION
RELOC_END	RTS

PRG	INCBIN	HACK.BIN
;PRG	INCBIN	TEST.BIN
PRG_END


